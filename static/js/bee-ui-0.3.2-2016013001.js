
(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Bee=f()}})(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){var Event={$on:function(name,handler,context){var ctx=context||this;ctx._handlers=ctx._handlers||{};ctx._handlers[name]=ctx._handlers[name]||[];ctx._handlers[name].push({handler:handler,context:context,ctx:ctx});},$one:function(name,handler,context){if(handler){handler.one=true;}
return this.$on(name,handler,context);},$off:function(name,handler,context){var ctx=context||this,handlers=ctx._handlers;if(name&&handlers[name]){if(typeof handler==='function'){for(var i=handlers[name].length-1;i>=0;i--){if(handlers[name][i].handler===handler){handlers[name].splice(i,1);}}}else{handlers[name]=[];}}},$emit:function(name,data){var args=[].slice.call(arguments,1),handlers=this._handlers&&this._handlers[name];if(handlers){for(var i=0,item;item=handlers[i];i++){item.handler.apply(this,args);if(item.handler.one){handlers.splice(i,1);i--;}}}}};module.exports=Event;},{}],2:[function(_dereq_,module,exports){"use strict";var doc=_dereq_('./env.js').document,utils=_dereq_('./utils.js'),Class=_dereq_('./class.js'),directive=_dereq_('./directive.js'),Com=_dereq_('./component.js'),Watcher=_dereq_('./watcher.js'),dirs=_dereq_('./directives'),domUtils=_dereq_('./dom-utils.js'),checkBinding=_dereq_('./check-binding.js'),scope=_dereq_('./scope'),Dir=directive.Directive;var isObject=utils.isObject,isPlainObject=utils.isPlainObject,parseKeyPath=utils.parseKeyPath,deepSet=utils.deepSet,extend=utils.extend,create=utils.create;function setPrefix(newPrefix){if(newPrefix){this.prefix=newPrefix;}}
var mergeProps={$data:1};var lifeCycles={$beforeInit:utils.noop,$afterInit:utils.noop,$beforeUpdate:utils.noop,$afterUpdate:utils.noop,$beforeDestroy:utils.noop,$afterDestroy:utils.noop};function Bee(tpl,props){if(isPlainObject(tpl)){props=tpl;}else{props=props||{};if(tpl){props.$tpl=tpl;}}
var defaults={$data:extend(true,{},this.constructor.defaults),$refs:{},$mixins:[],$el:this.$el||null,$tpl:this.$tpl||'<div>{{> $content }}</div>',$content:this.$content||null,$isReplace:false,$parent:null,$root:this,$context:null,_watchers:{},_assignments:null,_relativePath:[],__links:[],_isRendered:false};var mixins=[defaults].concat(this.$mixins).concat(props.$mixins).concat([props])
mixins.forEach(function(mixin){var prop;for(var propKey in mixin){if(mixin.hasOwnProperty(propKey)){if((propKey in mergeProps)&&isObject(mixin[propKey])){prop=extend({},this[propKey],mixin[propKey])
this[propKey]=extend(mixin[propKey],prop)}else if(propKey in lifeCycles){this[propKey]=utils.afterFn(this[propKey],mixin[propKey])}else{this[propKey]=mixin[propKey];}}}}.bind(this))
extend(this,this.$data);resolveTpl.call(this);this.$beforeInit()
this.$el.bee=this;this.__links=this.__links.concat(checkBinding.walk.call(this,this.$el));this._isRendered=true;this.$afterInit();}
extend(Bee,{extend:utils.afterFn(Class.extend,utils.noop,function(sub,args){var staticProps=args[1]||{};sub.directives=extend(create(this.directives),staticProps.directives);sub.components=extend(create(this.components),staticProps.components);sub.filters=extend(create(this.filters),staticProps.filters);sub.defaults=extend(true,{},this.defaults,staticProps.defaults);}),utils:utils},Dir,Com,{setPrefix:setPrefix,directive:directive.directive,prefix:'',doc:doc,directives:{},components:{},defaults:{},filters:{json:function(obj,replacer,space){return JSON.stringify(obj,replacer,space)}},filter:function(filterName,filter){this.filters[filterName]=filter;},mount:function(id,props){var el=id.nodeType?id:doc.getElementById(id);var instance;var dirs=directive.getDirs(el,this);var Comp,dir;dir=dirs.filter(function(dir){return dir.type==='tag'||dir.type==='component'})[0];if(dir){Comp=this.getComponent(dir.path)}
props=props||{};if(Comp){props.$data=extend(domUtils.getAttrs(el),props.$data)
instance=new Comp(extend({$el:el,$isReplace:true,__mountcall:true},props))}else{instance=new this(el,props);}
return instance}});Bee.setPrefix('b-');for(var dir in dirs){Bee.directive(dir,dirs[dir]);}
extend(Bee.prototype,lifeCycles,{$get:function(expression){var dir=new Dir('$get',{path:expression,watch:false});dir.parse();return dir.getValue(this,false)},$set:function(key,val){var add,keys,hasKey=false;var reformed,reKey,reVm=this;if(arguments.length===1){if(isObject(key)){extend(this.$data,key);extend(this,key);}else{this.$data=key;}
update.call(reVm,key);}else{this.$replace(key,val);}},$replace:function(key,val){var keys,last,hasKey=false;var reformed,reKey,reVm=this;if(arguments.length===1){val=key;reKey='$data';keys=[reKey];}else{hasKey=true;reformed=scope.reformScope(this,key)
reKey=reformed.path;reVm=reformed.vm;keys=parseKeyPath(reKey);}
last=reVm.$get(reKey);if(keys[0]==='$data'){if(reKey==='$data'){if(isObject(this.$data)){Object.keys(this.$data).forEach(function(k){delete this[k];}.bind(this))}
extend(reVm,val);}else{deepSet(keys.shift().join('.'),val,reVm)}}else{deepSet(reKey,val,reVm.$data);}
deepSet(reKey,val,reVm)
hasKey?update.call(reVm,reKey,extend({},last,val)):update.call(reVm,extend({},last,val));},$update:function(keyPath,isBubble){isBubble=isBubble!==false;var keys=parseKeyPath(keyPath.replace(/^\$data\./,'')),key;var watchers;while(key=keys.join('.')){watchers=this._watchers[key]||[];for(var i=0,l=watchers.length;i<l;i++){watchers[i]&&watchers[i].update();}
if(isBubble){keys.pop();if(!keys.length&&key!=='$data'){keys.push('$data');}}else{break;}}
Watcher.getWatchers(this,keyPath).forEach(function(watcher){watcher.update();}.bind(this))
if(isBubble){if(this.$parent){this._relativePath.forEach(function(path){this.$parent.$update(path);}.bind(this))}}},$watch:function(expression,callback,immediate){if(callback){var update=callback.bind(this);update._originFn=callback;return Watcher.addWatcher.call(this,new Dir('$watch',{path:expression,update:update,immediate:!!immediate}))}},$unwatch:function(expression,callback){Watcher.unwatch(this,expression,callback)},$destroy:function(removeEl){this.$beforeDestroy()
this.__links.forEach(function(wacher){wacher.unwatch()})
removeEl!==false&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)
this.__links=[];this.$afterDestroy()}});function update(keyPath,data){var keyPaths;this.$beforeUpdate(this.$data)
if(arguments.length===1){data=keyPath;}else{keyPaths=[keyPath];}
if(!keyPaths){if(isObject(data)){keyPaths=Object.keys(data);}else{keyPaths=['$data'];}}
for(var i=0,path;path=keyPaths[i];i++){this.$update(path,true);}
this.$afterUpdate(this.$data)}
function resolveTpl(){var el=this.$el,content=this.$content,tpl=this.$tpl,tplEl;content=el&&el.childNodes?el.childNodes:content
if(el){content=el.childNodes;}
if(content){this.$content=domUtils.createContent(content)}
if(utils.isObject(tpl)){tplEl=tpl;tpl=tplEl.outerHTML;}else{tplEl=domUtils.createContent(tpl).childNodes[0];}
if(el){if(this.$isReplace){el.parentNode&&el.parentNode.replaceChild(tplEl,el)
el=tplEl;}else{el.appendChild(tplEl)}}else{el=tplEl;}
this.$el=el;}
Bee.version='0.5.3';module.exports=Bee;},{"./check-binding.js":3,"./class.js":4,"./component.js":5,"./directive.js":6,"./directives":12,"./dom-utils.js":18,"./env.js":19,"./scope":24,"./utils.js":26,"./watcher.js":27}],3:[function(_dereq_,module,exports){"use strict";var Watcher=_dereq_('./watcher'),token=_dereq_('./token.js'),utils=_dereq_('./utils'),doc=_dereq_('./env.js').document,directive=_dereq_('./directive');var NODETYPE={ELEMENT:1,ATTR:2,TEXT:3,COMMENT:8,FRAGMENT:11};doc.createElement('template');function walk(el){var watchers=[],dirResult;if(el.nodeType===NODETYPE.FRAGMENT){el=el.childNodes;}
if(('length'in el)&&utils.isUndefined(el.nodeType)){for(var i=0;i<el.length;i++){watchers=watchers.concat(walk.call(this,el[i]));}
return watchers;}
switch(el.nodeType){case NODETYPE.ELEMENT:break;case NODETYPE.COMMENT:return watchers;break;case NODETYPE.TEXT:watchers=watchers.concat(checkText.call(this,el));return watchers;}
if(el.nodeName.toLowerCase()==='template'){if(!el.content){el.content=doc.createDocumentFragment();while(el.childNodes[0]){el.content.appendChild(el.childNodes[0])}}}
dirResult=checkAttr.call(this,el);watchers=watchers.concat(dirResult.watchers)
if(dirResult.terminal){return watchers;}
if(el.nodeName.toLowerCase()==='template'){watchers=watchers.concat(walk.call(this,el.content))}
for(var child=el.firstChild,next;child;){next=child.nextSibling;watchers=watchers.concat(walk.call(this,child));child=next;}
return watchers}
function checkAttr(el){var cstr=this.constructor,dirs=directive.getDirs(el,cstr,this.$context),dir,terminalPriority,watchers=[],result={};;for(var i=0,l=dirs.length;i<l;i++){dir=dirs[i];dir.dirs=dirs;if(terminalPriority>dir.priority){break;}
el.removeAttribute(dir.nodeName);watchers=watchers.concat(setBinding.call(this,dir));if(dir.terminal){result.terminal=true;terminalPriority=dir.priority;}}
result.watchers=watchers
return result}
var partialReg=/^>\s*/;function checkText(node){var watchers=[];if(token.hasToken(node.nodeValue)){var tokens=token.parseToken(node.nodeValue),textMap=tokens.textMap,el=node.parentNode,dirs=this.constructor.directives,t,dir;if(textMap.length>1){textMap.forEach(function(text){var tn=doc.createTextNode(text);el.insertBefore(tn,node);watchers=watchers.concat(checkText.call(this,tn));}.bind(this));el.removeChild(node);}else{t=tokens[0];if(partialReg.test(t.path)){t.path=t.path.replace(partialReg,'');dir=utils.create(dirs.content)
dir.dirName=dir.type
dir.anchors=directive.setAnchors(node,dir.type)}else{dir=utils.create(t.escape?dirs.text:dirs.html)}
watchers=setBinding.call(this,utils.extend(dir,t,{el:node}));}}
return watchers}
function setBinding(dir){var watcher
if(dir.replace){var el=dir.el;if(utils.isFunction(dir.replace)){dir.node=dir.replace();}else{dir.node=doc.createTextNode('');}
dir.el=dir.el.parentNode;dir.el.replaceChild(dir.node,el);}
dir.vm=this;dir.link();watcher=Watcher.addWatcher.call(this,dir)
return watcher?[watcher]:[]}
function unBinding(watchers){watchers.forEach(function(watcher){watcher.unwatch()})}
module.exports={walk:walk,unBinding:unBinding};},{"./directive":6,"./env.js":19,"./token.js":25,"./utils":26,"./watcher":27}],4:[function(_dereq_,module,exports){var extend=_dereq_('./utils.js').extend;var Class={extend:function(protoProps,staticProps){protoProps=protoProps||{};var constructor=protoProps.hasOwnProperty('constructor')?protoProps.constructor:function(){return sup.apply(this,arguments);}
var sup=this;var Fn=function(){this.constructor=constructor;};var supRef={__super__:sup.prototype};Fn.prototype=sup.prototype;constructor.prototype=new Fn();extend(constructor.prototype,supRef,protoProps);extend(constructor,sup,supRef,staticProps);return constructor;}};module.exports=Class;},{"./utils.js":26}],5:[function(_dereq_,module,exports){"use strict";var utils=_dereq_('./utils.js');function tag(tagName,Component,statics){var tags=this.components=this.components||{};this.doc.createElement(tagName);if(utils.isObject(Component)){Component=this.extend(Component,statics);}
return tags[tagName]=Component;}
function getComponent(componentName,context){var paths=utils.parseKeyPath(componentName);var CurCstr=this;paths.forEach(function(comName){CurCstr=CurCstr&&CurCstr.components[comName];});if(context&&context.constructor&&!CurCstr){CurCstr=context.constructor.getComponent(componentName,context.$context);}
return CurCstr||null;}
exports.tag=exports.component=tag;exports.getComponent=getComponent;},{"./utils.js":26}],6:[function(_dereq_,module,exports){"use strict";var utils=_dereq_('./utils.js'),token=_dereq_('./token.js'),doc=_dereq_('./env.js').document,parse=_dereq_('./parse.js').parse,evaluate=_dereq_('./eval.js'),domUtils=_dereq_('./dom-utils'),create=utils.create;function directive(key,opts){var dirs=this.directives=this.directives||{};return dirs[key]=new Directive(key,opts);}
function Directive(key,opts){this.type=key;utils.extend(this,opts);}
var astCache={};Directive.prototype={priority:0,type:'',subType:'',sub:false,link:utils.noop,unLink:utils.noop,update:utils.noop,tearDown:utils.noop,terminal:false,replace:false,watch:true,immediate:true,anchor:false,anchors:null,getNodes:function(start,end){start=start||this.anchors.start;end=end||this.anchors.end;var nodes=[],node=start.nextSibling;if(this.anchor&&node){while(node!==end){nodes.push(node);node=node.nextSibling;}
return nodes;}},parse:function(){var cache=astCache[this.path]
if(cache&&cache._type===this.type){this.ast=cache}else{if(this.type=='attr'&&this.escape===false){this.path='{'+this.path+'}'}
try{this.ast=parse(this.path,this.type);this.ast._type=this.type;astCache[this.path]=this.ast;}catch(e){this.ast={};e.message='SyntaxError in "'+this.path+'" | '+e.message;console.error(e);}}},getValue:function(scope,forgive){forgive=forgive!==false;var val;try{val=evaluate.eval(this.ast,scope,this);}catch(e){val='';console.error(e);}
if(forgive&&(utils.isUndefined(val)||val===null)){val='';}
return val;}};var attrPostReg=/\?$/;function getDirs(el,cstr,context){var attr,attrName,dirName,proto,dirs=[],dir,parent=el.parentNode,nodeName=el.nodeName.toLowerCase(),directives=cstr.directives,prefix=cstr.prefix;if(cstr.getComponent(nodeName,context)){el.setAttribute(prefix+'component',nodeName);}
for(var i=el.attributes.length-1;i>=0;i--){attr=el.attributes[i];attrName=attr.nodeName;dirName=attrName.slice(prefix.length);proto={el:el,node:attr,nodeName:attrName,path:attr.value};dir=null;if(attrName.indexOf(prefix)===0&&(dir=getDir(dirName,directives))){dir.dirName=dirName}else if(token.hasToken(attr.value)){token.parseToken(attr.value).forEach(function(origin){origin.dirName=attrName;dirs.push(utils.extend(create(directives.attr),proto,origin))});}else if(attrPostReg.test(attrName)){dir=utils.extend(create(directives.attr),{dirName:attrName.replace(attrPostReg,''),conditional:true});}
if(dir){if(dir.anchor){dir.anchors=setAnchors(el,dir.dirName);}
dirs.push(utils.extend(dir,proto));}}
dirs.sort(function(d0,d1){return d1.priority-d0.priority;});return dirs;}
function getDir(dirName,dirs){var dir,subType;for(var key in dirs){if(dirName===key){dir=dirs[key]
break}else if(dirName.indexOf(key+'-')===0){dir=dirs[key]
if(!dir.sub){dir=null}else{subType=dirName.slice(key.length+1)}
break;}}
if(dir){dir=create(dir);dir.subType=subType;}
return dir;}
function setAnchors(node,dirName){var parent=node.parentNode,anchors={};anchors.start=doc.createComment(dirName+' start');parent.insertBefore(anchors.start,node);anchors.end=doc.createComment(dirName+' end');if(node.nextSibling){parent.insertBefore(anchors.end,node.nextSibling);}else{parent.appendChild(anchors.end);}
return anchors}
module.exports={Directive:Directive,directive:directive,getDirs:getDirs,setAnchors:setAnchors};},{"./dom-utils":18,"./env.js":19,"./eval.js":21,"./parse.js":23,"./token.js":25,"./utils.js":26}],7:[function(_dereq_,module,exports){"use strict";var utils=_dereq_('../utils.js');module.exports={link:function(){if(this.dirName===this.type&&this.nodeName!==this.dirName){this.attrs={};}else{this.update('')}},update:function(val){var el=this.el;var newAttrs={};var textMap=this.textMap
if(this.attrs){for(var attr in val){setProperty.call(this,el,attr,val[attr]);delete this.attrs[attr];newAttrs[attr]=true;}
for(var attr in this.attrs){removeProperty.call(this,el,attr);}
this.attrs=newAttrs;}else{if(this.conditional){val?setProperty.call(this,el,this.dirName,val):removeProperty.call(this,el,this.dirName);}else{textMap[this.position]=val;setProperty.call(this,el,this.dirName,textMap.length>1?textMap.join(''):textMap[0]);}}}};function setProperty(el,key,val){if(isComponent(this)){el.bee.$set(utils.hyphenToCamel(key),val)}else{setAttr(el,key,val)}}
function removeProperty(el,key,undef){if(isComponent(this)){el.bee.$set(utils.hyphenToCamel(key),undef)}else{el.removeAttribute(key);}}
function setAttr(el,attr,val){try{if(((attr in el)||attr==='class')){if(attr==='style'&&el.style.setAttribute){el.style.setAttribute('cssText',val);}else if(attr==='class'){el.className=val;}else{el[attr]=typeof el[attr]==='boolean'?true:val;}}}catch(e){}
el.setAttribute(attr,val);}
function isComponent(dir){var component=dir.el.bee;return component&&!component.__repeat&&component!=dir.vm;}},{"../utils.js":26}],8:[function(_dereq_,module,exports){"use strict";module.exports={link:function(){this.initClass=this.el.className||''
this.keys={};},update:function(classes){var classStr=this.initClass,watcher=this.watcher;if(typeof classes==='string'){if(classes){classStr+=' '+classes;}}else{for(var key in classes){if(!this.keys[key]){this.keys[key]=true;this.vm.$watch(key,function(){watcher.update()})}
if(this.vm.$get(key)){classStr+=' '+classes[key]}}}
this.el.className=classStr;}};},{}],9:[function(_dereq_,module,exports){var utils=_dereq_('../utils.js');var domUtils=_dereq_('../dom-utils')
var checkBinding=_dereq_('../check-binding')
module.exports={priority:-1,watch:false,unLink:function(){this.component&&this.component.$destroy()},link:function(){var vm=this.vm;var el=this.el;var cstr=vm.constructor;var comp;var dirs,$data={};var Comp=cstr.getComponent(this.path,vm.$context)
var statics={};if(Comp){if(Comp===cstr&&vm.__mountcall||el.bee&&el.bee===vm){return;}
dirs=this.dirs.filter(function(dir){return dir.type=='attr'||dir.type=='with';});dirs.forEach(function(dir){var curPath,comPath;curPath=dir.path;if(dir.type==='with'){utils.extend(true,$data,vm.$get(curPath))
vm.$watch(curPath,function(val){comp&&comp.$set(utils.extend({},vm.$get(curPath)));})}else{comPath=utils.hyphenToCamel(dir.dirName);$data[comPath]=getProperty(dir)
dir.el.removeAttribute(dir.dirName)}});vm.__links=vm.__links.concat(checkBinding.walk.call(vm,el.childNodes));statics=domUtils.getAttrs(el)
var _dir;for(var attr in statics){_dir=utils.camelToHyphen(attr);_dir=_dir.slice(vm.constructor.prefix.length)
if(_dir in vm.constructor.directives){delete statics[attr]}}
this.component=comp=new Comp({$el:el,$isReplace:true,$context:vm,$data:utils.extend(true,{},$data,statics)});el.bee=comp;return comp;}else{console.error('Component: '+this.path+' not defined!');}}};function getProperty(dir){var textMap=dir.textMap,val
val=textMap&&textMap.length>1?textMap.join(''):textMap[0]
return utils.isPlainObject(val)?utils.extend(true,{},val):val;}},{"../check-binding":3,"../dom-utils":18,"../utils.js":26}],10:[function(_dereq_,module,exports){"use strict";var domUtils=_dereq_('../dom-utils'),checkBinding=_dereq_('../check-binding');module.exports={replace:true,anchor:true,link:function(){this.watchers=[];},unLink:function(){this.watchers.forEach(function(watcher){watcher.unwatch()});},update:function(tpl){var nodes=this.getNodes()
var parent=this.anchors.end.parentNode
nodes.forEach(function(node){parent.removeChild(node);});this.unLink();var content=domUtils.createContent(tpl)
this.watchers=checkBinding.walk.call(this.vm,content)
parent.insertBefore(content,this.anchors.end)}}},{"../check-binding":3,"../dom-utils":18}],11:[function(_dereq_,module,exports){"use strict";var checkBinding=_dereq_('../check-binding'),domUtils=_dereq_('../dom-utils'),doc=_dereq_('../env').document
module.exports={anchor:true,priority:900,terminal:true,link:function(){this.watchers=[];if(this.el.content){this.frag=this.el.content;this.el.parentNode.removeChild(this.el);}else{this.frag=doc.createDocumentFragment()}
this.remove();},update:function(val){if(val){if(!this.state){this.add()}}else{if(this.state){this.remove();}}
this.state=val;},add:function(){var anchor=this.anchors.end;if(!this.walked){this.walked=true;this.watchers=checkBinding.walk.call(this.vm,this.frag);}
this.watchers.forEach(function(watcher){watcher._hide=false;if(watcher._needUpdate){watcher.update()
watcher._needUpdate=false;}})
anchor.parentNode&&anchor.parentNode.insertBefore(this.frag,anchor);},remove:function(){var nodes=this.getNodes();for(var i=0,l=nodes.length;i<l;i++){this.frag.appendChild(nodes[i]);}
this.watchers.forEach(function(watcher){watcher._hide=true;})}};},{"../check-binding":3,"../dom-utils":18,"../env":19}],12:[function(_dereq_,module,exports){"use strict";var doc=_dereq_('../env.js').document,utils=_dereq_('../utils.js'),checkBinding=_dereq_('../check-binding');var dirs={};dirs.text={terminal:true,replace:true,update:function(val){this.node.nodeValue=utils.isUndefined(val)?'':val;}};dirs.html={terminal:true,replace:true,link:function(){this.nodes=[];},update:function(val){var el=doc.createElement('div');el.innerHTML=utils.isUndefined(val)?'':val;var node;while(node=this.nodes.pop()){node.parentNode&&node.parentNode.removeChild(node);}
var nodes=el.childNodes;while(node=nodes[0]){this.nodes.push(node);this.el.insertBefore(node,this.node);}}};dirs.template={priority:10000,watch:false,link:function(){var nodes=this.el.childNodes,frag=doc.createDocumentFragment();while(nodes[0]){frag.appendChild(nodes[0]);}
this.el.content=frag;}};dirs.src={update:function(val){this.el.src=val;}};dirs['with']={};dirs['if']=_dereq_('./if')
dirs.repeat=_dereq_('./repeat');dirs.attr=_dereq_('./attr');dirs.model=_dereq_('./model');dirs.style=_dereq_('./style');dirs.on=_dereq_('./on');dirs.component=dirs.tag=_dereq_('./component');dirs.content=_dereq_('./content')
dirs.ref=_dereq_('./ref')
dirs['class']=_dereq_('./class.js')
module.exports=dirs;},{"../check-binding":3,"../env.js":19,"../utils.js":26,"./attr":7,"./class.js":8,"./component":9,"./content":10,"./if":11,"./model":13,"./on":14,"./ref":15,"./repeat":16,"./style":17}],13:[function(_dereq_,module,exports){"use strict";var utils=_dereq_('../utils.js'),hasToken=_dereq_('../token.js').hasToken,events=_dereq_('../event-bind.js'),checkBinding=_dereq_('../check-binding');module.exports={teminal:true,priority:-2,link:function(){var keyPath=this.path;var vm=this.vm;if(!keyPath){return false;}
var comp=this.el,ev='change',attr,value=attr='value',isSetDefaut=utils.isUndefined(vm.$get(keyPath)),crlf=/\r\n/g,update=function(val){if(val===0&&comp.type!=='checkbox'){val='0'}
var newVal=(val||'')+'',val=comp[attr];val&&val.replace&&(val=val.replace(crlf,'\n'));if(newVal!==val){comp[attr]=newVal;}},handler=function(){var val=comp[value];val.replace&&(val=val.replace(crlf,'\n'));vm.$set(keyPath,val);},callHandler=function(e){if(e&&e.propertyName&&e.propertyName!==attr){return;}
handler.apply(this,arguments)},ie=utils.ie;if(comp.bee){comp=comp.bee;value=comp.$valuekey;if(value){update=function(val){comp.$replace(value,val)};handler=function(){vm.$replace(keyPath,comp.$get(value))}
comp.$watch(value,function(val,oldValue){val!==oldValue&&handler()})
comp.$set(value,vm.$get(keyPath))}}else{vm.__links=vm.__links.concat(checkBinding.walk.call(vm,comp.childNodes));switch(comp.tagName){default:value=attr='innerHTML';case'INPUT':case'TEXTAREA':switch(comp.type){case'checkbox':value=attr='checked';if(ie){ev+=' click';}
break;case'radio':attr='checked';if(ie){ev+=' click';}
update=function(val){comp.checked=comp.value===val+'';};isSetDefaut=comp.checked;break;default:if(!vm.$lazy){if('oninput'in comp){ev+=' input';}
if(ie){ev+=' keyup propertychange cut';}}
break;}
break;case'SELECT':if(comp.multiple){handler=function(){var vals=[];for(var i=0,l=comp.options.length;i<l;i++){if(comp.options[i].selected){vals.push(comp.options[i].value)}}
vm.$replace(keyPath,vals);};update=function(vals){if(vals&&vals.length){for(var i=0,l=comp.options.length;i<l;i++){comp.options[i].selected=vals.indexOf(comp.options[i].value)!==-1;}}};}
isSetDefaut=isSetDefaut&&!hasToken(comp[value]);break;}
ev.split(/\s+/g).forEach(function(e){events.removeEvent(comp,e,callHandler);events.addEvent(comp,e,callHandler);});if(comp[value]&&isSetDefaut){handler();}}
this.update=update;}};},{"../check-binding":3,"../event-bind.js":22,"../token.js":25,"../utils.js":26}],14:[function(_dereq_,module,exports){"use strict";var eventBind=_dereq_('../event-bind.js');var utils=_dereq_('../utils')
module.exports={watch:false,sub:true,priority:-3,immediate:false,link:function(){var dir=this;if(this.subType){eventBind.addEvent(this.el,this.subType,function(){dir.vm.$get(dir.path)})}else{this.immediate=true;}},update:function(events){var selector,eventType;for(var name in events){selector=name.split(/\s+/);eventType=selector.shift();selector=selector.join(' ');eventBind.addEvent(this.el,eventType,callHandler(this,selector,events[name]));}}}
function callHandler(dir,selector,callback){return function(e){var cur=e.target||e.srcElement;var els=selector?utils.toArray(dir.el.querySelectorAll(selector)):[cur];do{if(els.indexOf(cur)>=0){e.delegateTarget=cur;return callback.call(dir.vm,e)}}while(cur=cur.parentNode)}}},{"../event-bind.js":22,"../utils":26}],15:[function(_dereq_,module,exports){var utils=_dereq_('../utils')
module.exports={watch:false,priority:-2,unLink:function(){if(!utils.isArray(this.ref)){this.vm.$refs[this.path]=null;}},link:function(){var vm=this.vm
if(vm.__repeat){if(!vm.$index){vm.$parent.$refs[this.path]=vm.__vmList;}}else{vm.$refs[this.path]=this.el.bee||this.el;}}}},{"../utils":26}],16:[function(_dereq_,module,exports){"use strict";var doc=_dereq_('../env.js').document,utils=_dereq_('../utils.js'),scope=_dereq_('../scope');var arrayMethods=['splice','push','pop','shift','unshift','sort','reverse'];module.exports={priority:1000,anchor:true,terminal:true,unLink:function(){this.vmList.forEach(function(vm){vm.$destroy()})},link:function(){var Bee=_dereq_('../bee')
this.trackId=this.el.getAttribute('track-by')
this.el.removeAttribute('track-by')
this.cstr=Bee.extend({},this.vm.constructor)
this.cstr.defaults={};this.curArr=[];this.vmList=[];if(this.el.content){this.frag=this.el.content;this.isRange=true}else{this.frag=this.el;}
this.el.parentNode.removeChild(this.el);},update:function(items){var curArr=this.curArr;var parentNode=this.anchors.end.parentNode;var that=this,vmList=this.vmList;var trackId=this.trackId;var arrs=[];if(utils.isArray(items)){this.listPath=this.summary.paths.filter(function(path){return!utils.isFunction(that.vm.$get(path))});arrDiff(curArr,items,trackId).forEach(function(item){var pos=indexByTrackId(item,curArr,trackId)
curArr.splice(pos,1)
if(that.isRange){getNodesByIndex(that,pos).forEach(function(node){parentNode.removeChild(node)})}else{parentNode.removeChild(vmList[pos].$el)}
vmList[pos].$destroy()
vmList.splice(pos,1)})
items.forEach(function(item,i){var pos=indexByTrackId(item,items,trackId,i),oldPos=indexByTrackId(item,curArr,trackId,i),vm,el,anchor;if(oldPos<0){el=this.frag.cloneNode(true)
if(this.isRange){anchor=doc.createComment('')
el.childNodes.length?el.insertBefore(anchor,el.childNodes[0]):el.appendChild(anchor)}
vm=new this.cstr(el,{$data:item,$index:pos,$root:this.vm.$root,$parent:this.vm,$context:this.vm.$context,_assignments:this.summary.assignments,__repeat:true,__anchor:anchor,__vmList:this.vmList});parentNode.insertBefore(vm.$el,getAnchor(that,pos))
vmList.splice(pos,0,vm);curArr.splice(pos,0,item)
vm._relativePath=this.listPath;}else{if(pos!==oldPos){parentNode.insertBefore(getElByIndex(that,oldPos),getAnchor(that,pos))
parentNode.insertBefore(getElByIndex(that,pos),getAnchor(that,oldPos+1))
vmList[oldPos]=[vmList[pos],vmList[pos]=vmList[oldPos]][0]
curArr[oldPos]=[curArr[pos],curArr[pos]=curArr[oldPos]][0]
vmList[pos].$index=pos
vmList[pos].$update('$index')}}}.bind(this))
vmList.forEach(function(vm,i){vm.$index=i
vm.$el.$index=i
vm.$update('$index',false)});this.listPath.forEach(function(localKey){var local=that.vm.$get(localKey)
utils.isArray(local)&&arrs.push(local)})
arrs.push(items)
arrs.forEach(function(local){var dirs=local.__dirs__;if(!dirs){utils.extend(local,{$set:function(i,item){local.splice(i,1,utils.isObject(item)?utils.extend({},local[i],item):item)},$replace:function(i,item){local.splice(i,1,item)},$remove:function(i){local.splice(i,1);}});arrayMethods.forEach(function(method){local[method]=utils.afterFn(local[method],function(){dirs.forEach(function(dir){dir.listPath.forEach(function(path){var reformed=scope.reformScope(dir.vm,path)
reformed.vm.$update(reformed.path)})})})});dirs=local.__dirs__=[];}
if(dirs.indexOf(that)===-1){dirs.push(that)}})}else{}}};function getAnchor(dir,index){var vm=dir.vmList[index]
return vm?(dir.isRange?vm.__anchor:vm.$el):dir.anchors.end}
function getNodesByIndex(dir,index){var vmList=dir.vmList,anchor=vmList[index].__anchor,next=vmList[index+1];return[anchor].concat(dir.getNodes(anchor,next&&next.__anchor))}
function getElByIndex(dir,index){var frag=doc.createDocumentFragment()
if(dir.isRange){getNodesByIndex(dir,index).forEach(function(node){frag.appendChild(node)})}else{frag.appendChild(dir.vmList[index].$el)}
return frag}
function arrDiff(arr1,arr2,trackId){var arr2Copy=arr2.slice();return arr1.filter(function(el){var result,index=indexByTrackId(el,arr2Copy,trackId)
if(index<0){result=true}else{arr2Copy.splice(index,1)}
return result})}
function indexByTrackId(item,list,trackId,startIndex){startIndex=startIndex||0;var index=list.indexOf(item,startIndex);if(index===-1&&trackId){for(var i=startIndex,item1;item1=list[i];i++){if(item[trackId]===item1[trackId]&&!utils.isUndefined(item[trackId])){index=i;break;}}}
return index;}},{"../bee":2,"../env.js":19,"../scope":24,"../utils.js":26}],17:[function(_dereq_,module,exports){"use strict";var utils=_dereq_('../utils')
var pixelAttrs=['width','height','min-width','min-height','max-width','max-height','margin','margin-top','margin-right','margin-left','margin-bottom','padding','padding-top','padding-right','padding-bottom','padding-left','top','left','right','bottom']
module.exports={link:function(){this.initStyle=this.el.style.getAttribute?this.el.style.getAttribute('cssText'):this.el.getAttribute('style')},update:function(styles){var el=this.el;var styleStr=this.initStyle?this.initStyle.replace(/;?$/,';'):'';var dashKey,val;if(typeof styles==='string'){styleStr+=styles;}else{for(var key in styles){val=styles[key];dashKey=utils.camelToHyphen(key);if(pixelAttrs.indexOf(dashKey)>=0&&utils.isNumeric(val)){val+='px';}
if(!utils.isUndefined(val)){styleStr+=dashKey+': '+val+'; ';}}}
if(el.style.setAttribute){el.style.setAttribute('cssText',styleStr);}else{el.setAttribute('style',styleStr);}}};},{"../utils":26}],18:[function(_dereq_,module,exports){"use strict";var doc=_dereq_('./env.js').document
var utils=_dereq_('./utils')
module.exports={createContent:function createContent(tpl){var content=doc.createDocumentFragment();var wraper;var nodes=[];if(utils.isObject(tpl)){if(tpl.nodeName&&tpl.nodeType){content.appendChild(tpl);}else if('length'in tpl){nodes=tpl;}}else{wraper=doc.createElement('div')
wraper.innerHTML=(tpl+'').trim();nodes=wraper.childNodes;}
while(nodes[0]){content.appendChild(nodes[0])}
return content;},getAttrs:function(el){var attributes=el.attributes;var attrs={};for(var i=attributes.length-1;i>=0;i--){attrs[utils.hyphenToCamel(attributes[i].nodeName)]=attributes[i].value;}
return attrs;},hasAttr:function(el,attrName){return el.hasAttribute?el.hasAttribute(attrName):!utils.isUndefined(el[attrName]);}};},{"./env.js":19,"./utils":26}],19:[function(_dereq_,module,exports){(function(root){"use strict";exports.root=root;exports.document=root.document||_dereq_('jsdom').jsdom();})((function(){return this})());},{"jsdom":52}],20:[function(_dereq_,module,exports){if(!Array.prototype.forEach){Array.prototype.forEach=function(fn,scope){for(var i=0,len=this.length;i<len;++i){if(i in this){fn.call(scope,this[i],i,this);}}};}
if(!Array.isArray){Array.isArray=function(val){return({}).toString.call(val)==='[object Array]'}}
if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'');};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0);i<this.length;i++){if(this[i]===obj){return i;}}
return-1;}}
if(!('lastIndexOf'in Array.prototype)){Array.prototype.lastIndexOf=function(find,i){if(i===undefined)i=this.length-1;if(i<0)i+=this.length;if(i>this.length-1)i=this.length-1;for(i++;i-->0;)
if(i in this&&this[i]===find)
return i;return-1;};}
if(!Array.prototype.filter){Array.prototype.filter=function(fun)
{"use strict";if(this===void 0||this===null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function"){throw new TypeError();}
var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisArg,val,i,t)){res.push(val);}}}
return res;};}
if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(" this is null or not defined");}
var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!="[object Function]"){throw new TypeError(callback+" is not a function");}
if(thisArg){T=thisArg;}
A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}
k++;}
return A;};}
if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}
if(!Object.keys){Object.keys=function(o){if(o!==Object(o)){throw new TypeError('Object.keys called on a non-object');}
var k=[],p;for(p in o){if(Object.prototype.hasOwnProperty.call(o,p)){k.push(p);}}
return k;}}
var noop=function(){};if(!window.console){window.console={log:noop,info:noop,debug:noop,warn:noop,error:noop}}},{}],21:[function(_dereq_,module,exports){"use strict";var scope=_dereq_('./scope')
var operators={'unary':{'+':function(v){return+v;},'-':function(v){return-v;},'!':function(v){return!v;},'[':function(v){return v;},'{':function(v){var r={};for(var i=0,l=v.length;i<l;i++){r[v[i][0]]=v[i][1];}
return r;},'typeof':function(v){return typeof v;},'new':function(v){return new v}},'binary':{'+':function(l,r){return l+r;},'-':function(l,r){return l-r;},'*':function(l,r){return l*r;},'/':function(l,r){return l/r;},'%':function(l,r){return l%r;},'<':function(l,r){return l<r;},'>':function(l,r){return l>r;},'<=':function(l,r){return l<=r;},'>=':function(l,r){return l>=r;},'==':function(l,r){return l==r;},'!=':function(l,r){return l!=r;},'===':function(l,r){return l===r;},'!==':function(l,r){return l!==r;},'&&':function(l,r){return l&&r;},'||':function(l,r){return l||r;},',':function(l,r){return l,r;},'.':function(l,r){var prev=this.first;if(r&&path&&!(prev.arity==='binary'&&prev.value==='[')){path=path+'.'+r;}
return l[r];},'[':function(l,r){if(typeof r!=='undefined'&&path){path=path+'.'+r;}
return l[r];},'(':function(l,r){return l.apply(root,r)},'|':function(l,r){return callFilter(l,r,[])},'new':function(l,r){return l===Date?new Function('return new Date('+r.join(', ')+')')():new(Function.prototype.bind.apply(l,[null].concat(r)));},'in':function(l,r){if(this.repeat){return r;}else{return l in r;}},'catchby':function(l,r){if(l['catch']){return l['catch'](r.bind(root))}else{summaryCall||console.error('catchby expect a promise')
return l;}}},'ternary':{'?':function(f,s,t){return f?s:t;},'(':function(f,s,t){return f[s].apply(f,t)},'|':function(f,s,t){return callFilter(f,s,t)}}};function callFilter(arg,filter,args){if(arg&&arg.then){return arg.then(function(data){return filter.apply(root,[data].concat(args))});}else{return filter.apply(root,[arg].concat(args))}}
var argName=['first','second','third'],context,summary,summaryCall,path,self,root;var evaluate=function(tree){var arity=tree.arity,value=tree.value,args=[],n=0,arg,res;for(;n<3;n++){arg=tree[argName[n]];if(arg){if(Array.isArray(arg)){args[n]=[];for(var i=0,l=arg.length;i<l;i++){args[n].push(typeof arg[i].key==='undefined'?evaluate(arg[i]):[arg[i].key,evaluate(arg[i])]);}}else{args[n]=evaluate(arg);}}}
if(arity!=='literal'){if(path&&value!=='.'&&value!=='['){summary.paths[path]=true;}
if(arity==='name'){path=value;}}
switch(arity){case'unary':case'binary':case'ternary':try{res=getOperator(arity,value).apply(tree,args);}catch(e){!summaryCall&&value=='('&&console.error(e);}
break;case'literal':res=value;break;case'repeat':summary.assignments[value]=true;break;case'name':res=getValue(value,context.locals);break;case'filter':summary.filters[value]=true;res=context.filters[value];break;case'this':res=context.locals;break;}
return res;};function getOperator(arity,value){return operators[arity][value]||function(){return;}}
function reset(scope,that){summaryCall=true;if(scope){root=scope.$root;summaryCall=false;context={locals:scope||{},filters:scope.constructor.filters||{}};}else{context={filters:{},locals:{}};}
if(that){self=that;}
summary={filters:{},paths:{},assignments:{}};path='';}
var getValue=function(key,vm){var reformed=scope.reformScope(vm,key)
return reformed.vm[reformed.path]}
exports.eval=function(tree,scope,that){reset(scope||{},that);return evaluate(tree);};exports.summary=function(tree){reset();evaluate(tree);if(path){summary.paths[path]=true;}
for(var key in summary){summary[key]=Object.keys(summary[key]);}
return summary;};},{"./scope":24}],22:[function(_dereq_,module,exports){"use strict";exports.addEvent=function addEvent(el,event,handler){if(el.addEventListener){el.addEventListener(event,handler,false);}else{el.attachEvent('on'+event,handler);}}
exports.removeEvent=function removeEvent(el,event,handler){if(el.removeEventListener){el.removeEventListener(event,handler);}else{el.detachEvent('on'+event,handler);}}},{}],23:[function(_dereq_,module,exports){"use strict";var create=Object.create||function(o){function F(){}
F.prototype=o;return new F();};var source;var error=function(message,t){t=t||this;var msg=message+=" But found '"+t.value+"'"+(t.from?" at "+t.from:"")+" in '"+source+"'";var e=new Error(msg);e.name=t.name="SyntaxError";t.message=message;throw e;};var tokenize=function(code,prefix,suffix){var c;var from;var i=0;var length=code.length;var n;var q;var str;var result=[];var make=function(type,value){return{type:type,value:value,from:from,to:i};};if(!code){return;}
c=code.charAt(i);while(c){from=i;if(c<=' '){i+=1;c=code.charAt(i);}else if((c>='a'&&c<='z')||(c>='A'&&c<='Z')||c==='$'||c==='_'){str=c;i+=1;for(;;){c=code.charAt(i);if((c>='a'&&c<='z')||(c>='A'&&c<='Z')||(c>='0'&&c<='9')||c==='_'){str+=c;i+=1;}else{break;}}
result.push(make('name',str));}else if(c>='0'&&c<='9'){str=c;i+=1;for(;;){c=code.charAt(i);if(c<'0'||c>'9'){break;}
i+=1;str+=c;}
if(c==='.'){i+=1;str+=c;for(;;){c=code.charAt(i);if(c<'0'||c>'9'){break;}
i+=1;str+=c;}}
if(c==='e'||c==='E'){i+=1;str+=c;c=code.charAt(i);if(c==='-'||c==='+'){i+=1;str+=c;c=code.charAt(i);}
if(c<'0'||c>'9'){error("Bad exponent",make('number',str));}
do{i+=1;str+=c;c=code.charAt(i);}while(c>='0'&&c<='9');}
if(c>='a'&&c<='z'){str+=c;i+=1;error("Bad number",make('number',str));}
n=+str;if(isFinite(n)){result.push(make('number',n));}else{error("Bad number",make('number',str));}}else if(c==='\''||c==='"'){str='';q=c;i+=1;for(;;){c=code.charAt(i);if(c<' '){make('string',str);error(c==='\n'||c==='\r'||c===''?"Unterminated string.":"Control character in string.",make('',str));}
if(c===q){break;}
if(c==='\\'){i+=1;if(i>=length){error("Unterminated string",make('string',str));}
c=code.charAt(i);switch(c){case'b':c='\b';break;case'f':c='\f';break;case'n':c='\n';break;case'r':c='\r';break;case't':c='\t';break;case'u':if(i>=length){error("Unterminated string",make('string',str));}
c=parseInt(code.substr(i+1,4),16);if(!isFinite(c)||c<0){error("Unterminated string",make('string',str));}
c=String.fromCharCode(c);i+=4;break;}}
str+=c;i+=1;}
i+=1;result.push(make('string',str));c=code.charAt(i);}else if(prefix.indexOf(c)>=0){str=c;i+=1;while(true){c=code.charAt(i);if(i>=length||suffix.indexOf(c)<0){break;}
str+=c;i+=1;}
result.push(make('operator',str));}else{i+=1;result.push(make('operator',c));c=code.charAt(i);}}
return result;};var make_parse=function(vars){vars=vars||{};var symbol_table={};var token;var tokens;var token_nr;var context;var itself=function(){return this;};var find=function(n){n.nud=itself;n.led=null;n.std=null;n.lbp=0;return n;};var advance=function(id){var a,o,t,v;if(id&&token.id!==id){error("Expected '"+id+"'.",token);}
if(token_nr>=tokens.length){token=symbol_table["(end)"];return;}
t=tokens[token_nr];token_nr+=1;v=t.value;a=t.type;if((a==="operator"||a!=='string')&&v in symbol_table){o=symbol_table[v];if(!o){error("Unknown operator.",t);}}else if(a==="name"){o=find(t);}else if(a==="string"||a==="number"||a==="regexp"){o=symbol_table["(literal)"];a="literal";}else{error("Unexpected token.",t);}
token=create(o);token.from=t.from;token.to=t.to;token.value=v;token.arity=a;return token;};var expression=function(rbp){var left;var t=token;advance();left=t.nud();while(rbp<token.lbp){t=token;advance();left=t.led(left);}
return left;};var original_symbol={nud:function(){error("Undefined.",this);},led:function(left){error("Missing operator.",this);}};var symbol=function(id,bp){var s=symbol_table[id];bp=bp||0;if(s){if(bp>=s.lbp){s.lbp=bp;}}else{s=create(original_symbol);s.id=s.value=id;s.lbp=bp;symbol_table[id]=s;}
return s;};var constant=function(s,v,a){var x=symbol(s);x.nud=function(){this.value=symbol_table[this.id].value;this.arity="literal";return this;};x.value=v;return x;};var infix=function(id,bp,led){var s=symbol(id,bp);s.led=led||function(left){this.first=left;this.second=expression(bp);this.arity="binary";return this;};return s;};var infixr=function(id,bp,led){var s=symbol(id,bp);s.led=led||function(left){this.first=left;this.second=expression(bp-1);this.arity="binary";return this;};return s;};var prefix=function(id,nud){var s=symbol(id);s.nud=nud||function(){this.first=expression(70);this.arity="unary";return this;};return s;};symbol("(end)");symbol("(name)");symbol(":");symbol(")");symbol("]");symbol("}");symbol(",");constant("true",true);constant("false",false);constant("null",null);constant("undefined");constant("Math",Math);constant("Date",Date);for(var v in vars){constant(v,vars[v]);}
symbol("(literal)").nud=itself;symbol("this").nud=function(){this.arity="this";return this;};infix("?",20,function(left){this.first=left;this.second=expression(0);advance(":");this.third=expression(0);this.arity="ternary";return this;});infixr("&&",31);infixr("||",30);infixr("===",40);infixr("!==",40);infixr("==",40);infixr("!=",40);infixr("<",40);infixr("<=",40);infixr(">",40);infixr(">=",40);infix("in",45,function(left){this.first=left;this.second=expression(0);this.arity="binary";if(context==='repeat'){left.arity='repeat';this.repeat=true;}
return this;});infix("+",50);infix("-",50);infix("*",60);infix("/",60);infix("%",60);infix("(",75,function(left){var a=[];if(left.id==="."||left.id==="["){this.arity="ternary";this.first=left.first;this.second=left.second;this.third=a;}else{this.arity="binary";this.first=left;this.second=a;if((left.arity!=="unary"||left.id!=="function")&&left.arity!=="name"&&left.arity!=="literal"&&left.id!=="("&&left.id!=="&&"&&left.id!=="||"&&left.id!=="?"){error("Expected a variable name.",left);}}
if(token.id!==")"){while(true){a.push(expression(1));if(token.id!==","){break;}
advance(",");}}
advance(")");return this;});infix(".",80,function(left){this.first=left;if(token.arity!=="name"){error("Expected a property name.",token);}
token.arity="literal";this.second=token;this.arity="binary";advance();return this;});infix("[",60,function(left){this.first=left;this.second=expression(0);this.arity="binary";advance("]");return this;});infix("|",10,function(left){var a;this.first=left;token.arity='filter';this.second=expression(10);this.arity='binary';if(token.id===':'){this.arity='ternary';this.third=a=[];while(true){advance(':');a.push(expression(10));if(token.id!==":"){break;}}}
return this;});infix('catchby',10);prefix("!");prefix("-");prefix("typeof");prefix("(",function(){var e=expression(0);advance(")");return e;});prefix("[",function(){var a=[];if(token.id!=="]"){while(true){a.push(expression(1));if(token.id!==","){break;}
advance(",");}}
advance("]");this.first=a;this.arity="unary";return this;});prefix("{",function(){var a=[],n,v;if(token.id!=="}"){while(true){n=token;if(n.arity!=="name"&&n.arity!=="literal"){error("Bad property name: ",token);}
advance();advance(":");v=expression(1);v.key=n.value;a.push(v);if(token.id!==","){break;}
advance(",");}}
advance("}");this.first=a;this.arity="unary";return this;});prefix('new',function(){var a=[];this.first=expression(79);if(token.id==='('){advance("(");this.arity='binary';this.second=a;while(true){a.push(expression(1));if(token.id!==","){break;}
advance(",");}
advance(")");}else{this.arity="unary";}
return this;});return function(_source,_context){source=_source;tokens=tokenize(_source,'=<>!+-*&|/%^','=<>&|');token_nr=0;context=_context;advance();var s=expression(0);advance("(end)");return s;};};exports.parse=make_parse();},{}],24:[function(_dereq_,module,exports){"use strict";var utils=_dereq_('./utils');var reformScope=function(vm,path){var paths=utils.parseKeyPath(path);var cur=vm,local=paths[0];var ass,curVm=cur;while(cur){curVm=cur;ass=cur._assignments;if(cur.__repeat){if(ass&&ass.length){if(local==='$index'||local==='$parent'){break;}else if(local===ass[0]){if(paths.length===1){paths[0]='$data';}else{paths.shift()}
break;}}else{if(path in cur){break;}}}
cur=cur.$parent;}
return{vm:curVm,path:paths.join('.')}};exports.reformScope=reformScope;},{"./utils":26}],25:[function(_dereq_,module,exports){var tokenReg=/{{({(.+?)}|.+?)}}/g;function hasToken(str){tokenReg.lastIndex=0;return str&&tokenReg.test(str);}
function parseToken(value){var tokens=[],textMap=[],start=0,val,token;tokenReg.lastIndex=0;while((val=tokenReg.exec(value))){if(tokenReg.lastIndex-start>val[0].length){textMap.push(value.slice(start,tokenReg.lastIndex-val[0].length));}
token={escape:!val[2],path:(val[2]||val[1]).trim(),position:textMap.length,textMap:textMap};tokens.push(token);textMap.push(val[0]);start=tokenReg.lastIndex;}
if(value.length>start){textMap.push(value.slice(start,value.length));}
tokens.textMap=textMap;return tokens;}
exports.hasToken=hasToken;exports.parseToken=parseToken;},{}],26:[function(_dereq_,module,exports){"use strict";var doc=_dereq_('./env.js').document;var keyPathReg=/(?:\.|\[)/g,bra=/\]/g;function parseKeyPath(keyPath){return keyPath.replace(bra,'').split(keyPathReg);}
function extend(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++;}
if(typeof target!=="object"&&!utils.isFunction(target)){target={};}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){if(name!=='prototype'){src=target[name];copy=options[name];if(deep&&copy&&(utils.isPlainObject(copy)||(copyIsArray=utils.isArray(copy)))){if(target===copy){continue;}
if(copyIsArray){copyIsArray=false;clone=src&&utils.isArray(src)?src:[];}else{clone=src&&utils.isPlainObject(src)?src:{};}
target[name]=extend(deep,clone,copy);}else if(!utils.isUndefined(copy)&&typeof target!=='string'){target[name]=copy;}}}}}
return target;}
var create=Object.create||function(o){function F(){}
F.prototype=o;return new F();};var deepGet=function(keyStr,obj){var chain,cur=obj,key;if(keyStr){chain=parseKeyPath(keyStr);for(var i=0,l=chain.length;i<l;i++){key=chain[i];if(cur){cur=cur[key];}else{return;}}}
return cur;}
var hyphensReg=/-(-?)([a-z])/ig;var hyphenToCamel=function(attrName){return attrName.replace(hyphensReg,function(s,dash,char){return dash?dash+char:char.toUpperCase();})}
var camelReg=/([A-Z])/g;var camelToHyphen=function(key){return key.replace(camelReg,function(upperChar){return'-'+upperChar.toLowerCase();})}
var utils={noop:function(){},ie:(function(){var undef,v=3,div=doc.createElement('div'),all=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->',all[0]);return v>4?v:undef;}()),isObject:function(val){return typeof val==='object'&&val!==null;},isUndefined:function(val){return typeof val==='undefined';},isFunction:function(val){return typeof val==='function';},isArray:function(val){if(utils.ie){return val&&val.constructor+''===Array+'';}else{return Array.isArray(val);}},isNumeric:function(val){return!utils.isArray(val)&&val-parseFloat(val)+1>=0;},isPlainObject:function(o){if(!o||({}).toString.call(o)!=='[object Object]'||o.nodeType||o===o.window){return false;}else{return true;}},beforeFn:function(oriFn,fn,breakCheck){return function(){var ret=fn.apply(this,arguments);if(breakCheck&&breakCheck.call(this,ret,arguments)){return ret;}
return oriFn.apply(this,arguments);};},afterFn:function(oriFn,fn,breakCheck){return function(){var ret=oriFn.apply(this,arguments);if(breakCheck&&breakCheck.call(this,ret,arguments)){return ret;}
fn.apply(this,arguments);return ret;}},parseKeyPath:parseKeyPath,deepSet:function(keyStr,value,obj){if(keyStr){var chain=parseKeyPath(keyStr),cur=obj;chain.forEach(function(key,i){if(i===chain.length-1){cur[key]=value;}else{if(cur&&cur.hasOwnProperty(key)){cur=cur[key];}else{cur[key]={};cur=cur[key];}}});}else{extend(obj,value);}
return obj;},extend:extend,create:create,toArray:function(arrLike){var arr=[];try{arr=Array.prototype.slice.call(arrLike)}catch(e){for(var i=0,l=arrLike.length;i<l;i++){arr[i]=arrLike[i]}}
return arr;},hyphenToCamel:hyphenToCamel,camelToHyphen:camelToHyphen};module.exports=utils;},{"./env.js":19}],27:[function(_dereq_,module,exports){"use strict";var evaluate=_dereq_('./eval.js'),utils=_dereq_('./utils.js'),parse=_dereq_('./parse.js').parse,reformScope=_dereq_('./scope').reformScope;var summaryCache={};function Watcher(vm,dir){var reformed,path,curVm=vm,watchers=[];var summary=summaryCache[dir.path]
dir.watcher=this;this.state=1;this.dir=dir;this.vm=vm;this.watchers=[];this.val=NaN;dir.parse();if(!summary||summary._type!==dir.type){summary=evaluate.summary(dir.ast);summary._type=dir.type;summaryCache[dir.path]=summary;}
dir.summary=summary
for(var i=0,l=dir.summary.paths.length;i<l;i++){reformed=reformScope(vm,dir.summary.paths[i])
curVm=reformed.vm
path=reformed.path
if(dir.watch){curVm._watchers[path]=curVm._watchers[path]||[];curVm._watchers[path].push(this);watchers=curVm._watchers[path];}else{watchers=[this];}
this.watchers.push(watchers);}
dir.immediate!==false&&this.update();}
function unwatch(vm,exp,callback){var summary;try{summary=evaluate.summary(parse(exp))}catch(e){e.message='SyntaxError in "'+exp+'" | '+e.message;console.error(e);}
summary.paths.forEach(function(path){var watchers=vm._watchers[path]||[],update;for(var i=watchers.length-1;i>=0;i--){update=watchers[i].dir.update;if(update===callback||update._originFn===callback){watchers[i].unwatch()}}})}
function addWatcher(dir){if(dir.path){return new Watcher(this,dir);}}
Watcher.unwatch=unwatch;Watcher.addWatcher=addWatcher;Watcher.getWatchers=function getWatchers(vm,keyPath){var _watchers=vm._watchers,watchers=[];var point;for(var key in _watchers){point=key.charAt(keyPath.length);if(key.indexOf(keyPath)===0&&(point==='.')){watchers=watchers.concat(_watchers[key])}}
return watchers}
function watcherUpdate(val){var oldValue=this.val;this.val=val;this.dir.update(val,oldValue);}
utils.extend(Watcher.prototype,{update:function(){var that=this,newVal;if(this._hide){this._needUpdate=true;return;}
newVal=this.dir.getValue(this.vm);if(newVal!==this.val||utils.isObject(newVal)){if(newVal&&newVal.then){newVal.then(function(val){watcherUpdate.call(that,val);});}else{watcherUpdate.call(this,newVal);}}},unwatch:function(){this.watchers.forEach(function(watchers){for(var i=watchers.length-1;i>=0;i--){if(watchers[i]===this){if(this.state){watchers[i].dir.unLink();this.state=0;}
watchers.splice(i,1);}}}.bind(this))
this.watchers=[];}});module.exports=Watcher},{"./eval.js":21,"./parse.js":23,"./scope":24,"./utils.js":26}],28:[function(_dereq_,module,exports){var Bee=_dereq_('beejs')
var Event=_dereq_('beejs/addons/event')
var beeEventBind=_dereq_('beejs/src/event-bind')
window.Bee=Bee;Bee.directive('on',$.extend({},Bee.directives.on,{update:function(events){var selector,eventType;for(var name in events){selector=name.split(/\s+/);eventType=selector.shift();selector=selector.join(' ');$(this.el).on(eventType,selector,events[name].bind(this.vm))}}}))
var ComponentBase=Bee.extend({$beforeInit:function(){var dataSelector=this.$data.dataSelector||'script[data]'
var dataEl
if(this.$content){dataEl=this.$content.querySelector(dataSelector)
this.$set(JSON.parse(dataEl&&dataEl.innerHTML.trim()||'{}'))}},$mixins:[Event]});beeEventBind.addEvent=function(el,type,callback){$(el).on(type,callback)}
beeEventBind.removeEvent=function(el,type,callback){$(el).off(type,callback)}
Bee.ComponentBase=ComponentBase;module.exports=ComponentBase;},{"beejs":2,"beejs/addons/event":1,"beejs/src/event-bind":22}],29:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"device-selector\" class=\"tc-15-mod-selector\">\n    <div b-on=\"events\" class=\"tc-15-mod-selector-tb\">\n        <div class=\"tc-15-option-cell options-left\">\n            <div class=\"tc-15-option-hd\">\n                <h4>{{title}}</h4>\n            </div>\n            <div class=\"tc-15-option-bd\">\n              <div class=\"search-box {{multipleSearch ? 'multi-search-box' : ''}}\">\n                <div class=\"search-input-wrap\">\n                <input b-if=\"!multipleSearch\" style=\"padding-left: 10px;\" data-search type=\"text\" placeholder=\"{{searchPlaceHolder}}\" b-model=\"keyword\" class=\"tc-15-input-text search-input\">\n                <textarea b-if=\"multipleSearch\" data-search type=\"text\" placeholder=\"{{searchPlaceHolder}}\" b-model=\"keyword\" class=\"tc-15-input-text search-input\"></textarea>\n                <a title=\"清空\" b-on-click=\"searchReset()\" class=\"btn-rm-txt\" role=\"button\" href=\"javascript:;\">清空</a>\n                </div>\n                <input type=\"button\" data-search-btn value=\"搜索\" class=\"search-btn\">\n              </div>\n              <div class=\"tc-15-option-box\">\n                <div class=\"info-row\" b-if=\"list.length && searchKey\">{{> searchTipTpl }}，<a b-on-click=\"backList()\" href=\"javascript:;\">返回列表</a></div>\n                <ul data-list class=\"tc-15-option-list\">\n                    <li b-repeat=\"item in list\" class=\"{{item.selected ? 'selected' : ''}} {{item.disabled ? 'disabled' : ''}}\" title?=\"item.$title\">\n                        {{> listTpl }}\n                    </li>\n                </ul>\n                <div class=\"info-row\" b-if=\"loading\"><b class=\"n-loading-icon\"></b>正在加载...</div>\n                <div class=\"info-row\" b-if=\"!list.length && !loading\">\n                  <b class=\"n-error-icon\"></b>{{emptyTips || (\"未找到匹配\" + deviceName)}} <a b-if=\"searchKey\" b-on-click=\"backList()\" href=\"javascript:;\">返回列表</a>\n                </div>\n              </div>\n            </div>\n        </div>\n        <div class=\"tc-15-option-cell separator-cell\">\n          <i class=\"icon-sep\"></i>\n        </div>\n        <div class=\"tc-15-option-cell options-right\">\n          <div class=\"tc-15-option-hd\">\n            <h4>已选择 ({{selected.length}})</h4>\n          </div>\n          <div class=\"tc-15-option-bd\">\n            <div class=\"tc-15-option-box\">\n              <ul data-selected class=\"tc-15-option-list\">\n                  <li b-repeat=\"item in selected\">\n                      {{> selectedTpl }}\n                  </li>\n              </ul>\n              <div class=\"info-row\" b-if=\"!selected.length\">\n                {{selectedEmptyTips || (\"暂无关联\" + deviceName)}}\n              </div>\n            </div>\n          </div>\n        </div>\n    </div>\n    <p class=\"tc-15-mod-selector-tips\">支持按住Shift进行多选</p>\n</div>\n";var Base=_dereq_('../componentBase');var Bee=_dereq_('beejs');var defaults={title:'选择云服务器',searchPlaceHolder:'搜索名称、内网IP',alias:{'name':'alias','ip':'deviceLanIp','network':'netName','id':'uuid'},emptyTips:'',selectedEmptyTips:'',deviceName:'云服务器',keyword:'',list:[],size:undefined,selected:[],scrollPager:false,pageCoef:1,loading:false,initGetData:false,multipleSearch:false,page:1,count:20,showDesc:true};var DeviceSelector=Base.extend({$tpl:tpl,$afterInit:function $afterInit(){this.selected.forEach(function(item){return item.selected=true;});this._updateList(this.selected);this.initGetData&&this._getData({page:1,count:this.count});this.bindEvent();},listTpl:'\n    <input type="checkbox" disabled?="item.disabled" class="tc-15-checkbox" b-model="item.selected">\n    <span class="opt-txt">\n      <span class="opt-txt-inner">\n        {{> itemTpl}}\n      </span>\n    </span>',selectedTpl:'\n    <span class="opt-txt">\n      <span class="opt-txt-inner">\n        {{> itemTpl}}\n      </span>\n    </span>\n    <a role="button" class="opt-act" href="javascript:;">\n      <i b-on="{click: _delSelected}" class="icon-del">取消</i>\n    </a>',itemTpl:'\n      <span class="item-name">{{> nameTpl}}</span>\n      <span class="item-descr" b-if="showDesc">{{> descTpl}}</span>',nameTpl:'{{item[alias.name]}}',descTpl:'{{item[alias.network]}} | {{item[alias.ip]}}',searchTipTpl:'共找到 {{size || list.length}} 云主机',search:function search(keyword){var that=this;this._getData({page:1,count:this.count,searchKey:keyword});},_getData:function _getData(opts){var that=this;var def=$.Deferred();this.$set('loading',true);if(opts.page===1){that.$set('list',[]);}
this.getData(opts,function(err,data){that.$set('loading',false);if(data){if(opts.searchKey!==that.searchKey||opts.page===1){that.$set($.extend({},opts,data));}else{that.$set({'size':data.size,'list':that.list.concat(data.list)});}
that._updateList(that.selected);}
err?def.reject(err):def.resolve(data);});return def.promise();},getData:function getData(opts,callback){callback(null,{list:this.list,size:this.size});},backList:function backList(){this.searchReset();},searchReset:function searchReset(){this.$set('keyword','');this.search('');},_updateSelected:function _updateSelected(items){var selected=this.selected;var idKey=this.alias.id;items.forEach((function(item){for(var i=0,l=selected.length;i<l;i++){if(selected[i]===item||typeof item[idKey]!=='undefined'&&selected[i][idKey]===item[idKey]){item.selected||selected.splice(i,1);return;}}
item.selected&&selected.push(item);}).bind(this));},_updateList:function _updateList(items){var list=this.list;var idKey=this.alias.id;items.forEach(function(item){for(var i=0,l=list.length;i<l;i++){if(list[i]===item||typeof item[idKey]!=='undefined'&&list[i][idKey]===item[idKey]){list.$set(i,item);return;}}});},replaceList:function replaceList(list){this.$replace('list',list);this._updateList(this.selected);},replaceSelected:function replaceSelected(selected){this.$set('selected',selected||[]);this._updateList(this.selected.map(function(item){item.selected=true;return item;}));},nextPage:function nextPage(){var that=this;that._getData({page:that.page+1,count:that.count,searchKey:that.searchKey}).done(function(){that.page++;});},_delSelected:function _delSelected(e){this.$data.selected=false;var items=[this.$data];this.$root._updateSelected(items);this.$root._updateList(items);},bindEvent:function bindEvent(){var _this=this;var that=this;var $list=this._$list=$(this.$el).find('[data-list]');this._scrollLoad({list:$list,checkFn:function checkFn(){return!that.loading&&that.page*that.count<that.size;},callback:function callback(){return _this.nextPage();}});this._scrollLoad({list:$(this.$el).find('[data-selected]'),checkFn:function checkFn(){return!that.loading&&that.selectedPage*that.count<that.selectedSize;},callback:function callback(){}});},_scrollLoad:function _scrollLoad(){var _this2=this;var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var $list=opts.list;var $listBox=$list.parent();var checkFn=opts.checkFn||function(){};var callback=opts.callback||function(){};$listBox.on('scroll',function(){if(_this2.scrollPager&&checkFn()){var listHeight=$list.height();var height=$listBox.height();if(listHeight-$listBox.scrollTop()<=height*(_this2.pageCoef+1)){callback();}}});},events:{"click [data-search-btn]":function clickDataSearchBtn(e){this.search(this.keyword||'');},"keydown [data-search]":function keydownDataSearch(e){if(e.keyCode==13){if(!this.multipleSearch||this.multipleSearch&&e.ctrlKey){this.search(this.keyword||'');}}},"mousedown [data-list]>li:not(.disabled)":function mousedownDataListLiNotDisabled(e){var $root=this.$root;var shiftIndex=$root._shiftIndex;var isSelected=$root.list[shiftIndex]&&$root.list[shiftIndex].selected;if(e.shiftKey&&typeof shiftIndex!=='undefined'&&isSelected){this._$list.css({'user-select':'none'});}},"click [data-list]>li:not(.disabled)":function clickDataListLiNotDisabled(e){var _this3=this;setTimeout(function(){var bee;if(e.target.tagName!=='INPUT'){bee=e.currentTarget.bee;bee.$set('item.selected',!bee.$get('item.selected'));}
var $root=_this3.$root,start,end;var shiftIndex=$root._shiftIndex;var index=e.currentTarget.$index;var selects,unselects=[],unselectStart;var isSelected=$root.list[shiftIndex]&&$root.list[shiftIndex].selected;if(e.shiftKey&&typeof shiftIndex!=='undefined'&&isSelected){if(shiftIndex>index){start=index;end=shiftIndex;if(typeof $root.lastEnd!=='undefined'){if($root.lastEnd>shiftIndex){unselectStart=shiftIndex;unselects=$root.list.slice(shiftIndex,$root.lastEnd);}else{unselectStart=$root.lastEnd-1;unselects=$root.list.slice($root.lastEnd,start);}}
$root.lastEnd=start;}else{start=shiftIndex;end=index;if(typeof $root.lastEnd!=='undefined'){if($root.lastEnd<shiftIndex){unselectStart=$root.lastEnd-1;unselects=$root.list.slice($root.lastEnd,shiftIndex);}else{unselectStart=end;unselects=$root.list.slice(end,$root.lastEnd);}}
$root.lastEnd=end;}
selects=$root.list.slice(start,end+1);selects.forEach(function(item,i){if(!item.disabled){item.selected=isSelected;$root.list.$set(start+i,{selected:isSelected});}});var _unselects=[];unselects.forEach(function(item,i){$root.list.$set(unselectStart+1+i,{selected:!isSelected});_unselects.push($root.list[unselectStart+1+i]);});_this3._updateSelected(_unselects);_this3._$list.css({'user-select':''});}else{selects=[$root.list[index]];$root._shiftIndex=index;delete $root.lastEnd;isSelected=$root.list[index].selected;}
_this3._updateSelected(selects);},0);}}},{defaults:defaults});module.exports=DeviceSelector;},{"../componentBase":28,"beejs":2}],30:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"grid-editor\" b-style=\"style\" b-on=\"events\">\n<div class=\"tc-15-table-panel tc-15-table-panel-edit\" style=\"position:relative\" b-on=\"$events\">\n  <div data-grid-head class=\"tc-15-table-fixed-head\">\n    <table b-ref=\"head\" class=\"tc-15-table-box\">\n      <colgroup>\n        <col b-if=\"dragable\" style=\"width: 50px\">\n        <col b-repeat=\"col in shownColums\" b-style=\"{width: col.width || 'auto'}\">\n      </colgroup>\n      <thead>\n        <tr>\n          <th b-if=\"dragable\">\n            <div></div>\n          </th>\n          <th b-repeat=\"col in shownColums\">\n            <div>\n              {{> _getHeadContent(col) }}\n            </div>\n            <i class=\"resize-line-icon\" data-role=\"resizer\"\n              b-if=\"canResizeColum && $index < shownColums.length - 1\"></i>\n          </th>\n        </tr>\n      </thead>\n    </table>\n  </div>\n  <div data-grid-body class=\"tc-15-table-fixed-body\">\n    <table b-ref=\"body\" class=\"tc-15-table-box tc-15-table-rowhover\">\n      <colgroup>\n          <col b-if=\"dragable\" style=\"width: 40px;\">\n          <col b-repeat=\"col in shownColums\" b-style=\"{width: col.width || 'auto'}\">\n      </colgroup>\n      <tbody>\n      <tr data-tips b-if=\"_tips\">\n        <td class=\"text-center\" colspan=\"{{countCols(colums)}}\">\n            <div>{{> _tips }}</div>\n        </td>\n      </tr>\n      <tr data-index=\"{{$index}}\" track-by=\"{{trackKey}}\" b-ref=\"list\" b-repeat=\"item in list\"\n        b-attr=\"setTrAttr(trAttr, item)\"\n        b-style=\"{visibility: item._target ? 'hidden' : 'visible'}\"\n        class=\"{{selectedHighlight && item.$selected?'current':''}} {{item.$disable || item._remove ? 'disable': ''}}\">\n\n          <td b-if=\"dragable\" style=\"position:relative\">\n              <div data-drag-handler>\n                  <i class=\"ico-drag\"></i>\n              </div>\n              <span b-template b-if=\"insertBtn && !overMaxSize\">\n                <i style=\"top:-8px\" data-i=\"\" b-on-click=\"insert($index)\" class=\"ico-move-drag hover-icon\"></i>\n                <i style=\"bottom:-8px\" b-on-click=\"insert($index + 1)\" class=\"ico-move-drag hover-icon\"></i>\n              </span>\n          </td>\n          <td b-repeat=\"col in shownColums\" b-style=\"{position: $index ? '' : 'relative'}\">\n              <div>\n                {{> _getCellContent(item[col.key], item, col) }}\n              </div>\n              <span b-template b-if=\"insertBtn && !dragable && !$index && !overMaxSize\">\n                <i b-on-click=\"insert($parent.$index)\" style=\"top:-8px\" class=\"ico-move-drag hover-icon\"></i>\n                <i b-on-click=\"insert($parent.$index + 1)\" style=\"bottom:-8px\" class=\"ico-move-drag hover-icon\"></i>\n              </span>\n          </td>\n      </tr>\n  </tbody>\n  </table>\n  <!-- <i data-disable-line class=\"disabled-line\"></i> -->\n  </div>\n</div>\n</div>\n";var Bee=_dereq_('beejs');var GridView=_dereq_('../grid-view');var equal=_dereq_('deep-equal');var defaults={dragable:true,insertBtn:true,newData:{},overlayRate:0.3,maxSize:0,minSize:0,autoMaxHeight:false,emptyTips:'列表为空 <a b-on-click="insert(0)" href="javascript:;">+新增</a>'};var GridEditor=GridView.extend({$tpl:tpl,overMaxSize:false,overMinSize:false,actionTpl:'<span class="text-overflow">\n    <a href="javascript:;" class="links"\n      b-on-click="(item._remove ? restore : preRemove)($parent.$index)">{{item._remove ? "恢复删除" : "删除"}}\n    </a></span>',$afterInit:function $afterInit(){GridEditor.__super__.$afterInit.call(this);this.$refsBody=$(this.$refs.body);this._$removeLine=this._$el.find('[data-disable-line]');},preRemove:function preRemove(index){if(this.overMinSize){return false;}else{if(equal(this.list[index],this.newData)){this.remove(index);}else{this.updateItem(index,{_remove:true});this.checkSize();}
return true;}},remove:function remove(index){this.list.splice(index,1);this.checkSize();},removePreRemove:function removePreRemove(){for(var i=this.list.length-1;i>=0;i--){this.list[i]._remove&&this.remove(i);}},restore:function restore(index){if(this.overMaxSize){return false;}else{this.updateItem(index,{_remove:false});this.checkSize();return true;}},restoreAll:function restoreAll(){var _this=this;this.list.forEach(function(item,index){item._remove&&_this.restore(index);});},insert:function insert(index,data){if(this.overMaxSize){data=false;}else{data=$.extend({},data||this.newData);this.list.splice(index,0,data);this.checkSize();}
return data;},getSize:function getSize(){return this.list.filter(function(item){return!item._remove;}).length;},checkSize:function checkSize(){var length=this.getSize();this.$set({overMaxSize:this.maxSize>0&&length>=this.maxSize,overMinSize:this.minSize&&length<=this.minSize});this.$emit('sizeChange',{size:length,total:this.list.length});this.onSizeChange();},onSizeChange:function onSizeChange(){},getColByIndex:function getColByIndex(index){if(this.dragable){index--;}
return this.shownColums[index];},_cloneTr:function _cloneTr(tr){var $copy=this.$refsBody.clone();var $tr=$(tr).clone();$copy.width(this.$refsBody.width());$copy.find('tr').remove();$copy.append($tr);$copy.css($.extend({'position':'absolute'},this._getTrPos(tr)));this.$refsBody.after($copy);return $copy;},_getTrPos:function _getTrPos(tr){var trOffset=$(tr).offset();var boxOffset=this.$refsBody.offsetParent().offset();return{left:trOffset.left-boxOffset.left,top:trOffset.top-boxOffset.top};},$events:$.extend({},GridView.prototype.$events,{'mousedown [data-drag-handler]':function mousedownDataDragHandler(e){if(this._draging){return;}
var $tr=$(e.target).closest('tr');var index=$tr.attr('data-index')*1;this._$dragingTr=$tr;this._dragingIndex=index;this._$dragingItem=this._cloneTr($tr);this._$dragingItem.find('tr').addClass('current');this._initPos=this._getTrPos($tr);this._initClientPos={x:e.clientX,y:e.clientY};this._initRect=this.$el.getBoundingClientRect();this._lastY=e.clientY;this._setTarget(index);this._dragStart();e.preventDefault();}}),_dragStart:function _dragStart(){var _this2=this;this._draging=true;$(document).on('mousemove.grid_drag',function(e){if(_this2._draging){_this2._dragintDir=e.clientY-_this2._lastY;var rect=_this2.$el.getBoundingClientRect();_this2._$dragingItem.css({'z-index':9999,top:_this2._initPos.top+e.clientY-_this2._initClientPos.y+_this2._initRect.top-rect.top,left:_this2._initPos.left+e.clientX-_this2._initClientPos.x+_this2._initRect.left-rect.left});_this2._checkOverlay(_this2._dragintDir);}
_this2._lastY=e.clientY;}).on('mouseup.grid_drag',function(e){$(document).off('.grid_drag');_this2._dragDone();_this2._draging=false;});},_setTarget:function _setTarget(index){if(typeof this._targetIndex!=='undefined'){this.updateItem(this._targetIndex,{_target:false});this._exchange(this._targetIndex,index);}
this.$set('_targetIndex',index);this.updateItem(index,{_target:true});},_exchange:function _exchange(index,targetIndex,animate){var current=this.list.splice(index,1)[0];var that=this;this.list.splice(targetIndex,0,current);var $trs=this.$refsBody.find('tr[data-index]');this._$dragingTr=$trs.eq(targetIndex);if(animate!==false){var $lastTr=$trs.eq(index);var lastOffset=this._getTrPos(this._$dragingTr);var offset=this._getTrPos($lastTr);this._exchange_animate&&this._exchange_animate.stop();var $animatr=this._cloneTr($lastTr).css(lastOffset);this._exchange_animate=$animatr.stop().animate({top:offset.top},{duration:100,always:function always(){that._exchange_animate=null;that.updateItem(index,{_target:false});$animatr.remove();}});if(animate==2){var $targetTr=$trs.eq(targetIndex);var $animatr2=this._cloneTr($targetTr).css(offset);this._exchange_animate2=$animatr2.stop().animate({top:this._getTrPos($targetTr).top},{duration:100,always:function always(){that._exchange_animate2=null;that.updateItem(targetIndex,{_target:false});$animatr2.remove();}});this.updateItem(targetIndex,{_target:true});}
this.updateItem(index,{_target:true});}},_dragDone:function _dragDone(){this.updateItem(this._targetIndex,{_target:false});this._$dragingItem.remove();delete this._$dragingItem;delete this._targetIndex;},_checkOverlay:function _checkOverlay(dir){var _this3=this;var trs;var offset=this._$dragingItem.offset();var height=this._$dragingItem.outerHeight();var checkLine;if(dir>0){trs=this._$dragingTr.nextAll('tr').andSelf();checkLine=offset.top+height;}else if(dir<0){trs=this._$dragingTr.prevAll('tr').andSelf();checkLine=offset.top;}
if(trs){trs.each(function(i,tr){var rate=checkOverlay(checkLine,tr,dir);var index;if(rate>=_this3.overlayRate&&rate<=1){index=$(tr).attr('data-index')*1;if(index!==_this3._targetIndex){_this3._setTarget(index);}}});}}},{defaults:defaults});function checkOverlay(y,el,dir){var $el=$(el),h=$el.outerHeight(),offset=$el.offset();var rate;if(y<offset.top){rate=-1;}else if(y>offset.top+h){rate=2;}else{rate=dir>0?(y-offset.top)/h:(offset.top+h-y)/h;}
return rate;}
module.exports=GridEditor;},{"../grid-view":32,"beejs":2,"deep-equal":53}],31:[function(_dereq_,module,exports){'use strict';var tpl="<div>\n    <span class=\"tc-15-filtrate-btn{{ filterResult ? ' current' : ''}}\" b-on=\"{ click: _togglePopup }\" title=\"{{_getFilterTitle(filterResult)}}\">\n        <span>{{col.name}}</span>\n        <i class=\"filtrate-icon\"></i>\n    </span>\n\n  <div class=\"tc-15-filtrateu\" b-style=\"{\n    display: ui.popup ? 'block' : 'none',\n    width: enableClear ? '200px' : null,\n    right: col.pull == 'right' ? '10px' : null\n  }\" b-on=\"{ click: _stopPropagation }\">\n\n    <div class=\"tc-15-search\" b-if=\"search\" style=\"float: none; width: auto; margin: 10px 10px 5px;\">\n      <input data-input class=\"tc-15-search-words\" placeholder=\"搜索{{col.name}}\" b-model=\"keyword\" type=\"text\" style=\"width: 120px\" />\n      <button data-search class=\"tc-15-btn weak m search\"></button>\n    </div>\n\n\n    <ul class=\"tc-15-filtrate-menu\" role=\"menu\">\n      <li role=\"presentation\" class=\"tc-15-optgroup\" b-if=\"!singleMode\">\n        <label class=\"tc-15-checkbox-wrap\" title=\"全选/全不选\" style=\"position: relative\">\n          <input type=\"checkbox\"\n                 class=\"tc-15-checkbox\"\n                 b-model=\"allChecked\"\n                 b-on-change=\"enabled && _checkAllChange(allChecked)\"\n                 disabled?=\"!enabled\">\n          (全选)\n          <span b-if=\"hasChecked && !allChecked\" style=\"background: rgb(38, 134, 214); width: 6px; height: 6px; position: absolute; left: 15px;top: 12px; border-radius: 2px;\"></span>\n        </label>\n      </li>\n      <li role=\"presentation\" class=\"tc-15-optgroup\" b-repeat=\"option in _searchOptions(filterOptions, keyword)\">\n        <label class=\"tc-15-checkbox-wrap\" title=\"{{option.label}}\">\n          <input type=\"checkbox\"\n                 class=\"tc-15-checkbox\"\n                 b-model=\"option.checked\"\n                 b-on-change=\"enabled && _filterOptionChange(option)\"\n                 disabled?=\"!enabled || option.disabled\">\n          {{option.label}}\n        </label>\n      </li>\n    </ul>\n\n    <div class=\"tc-15-filtrate-ft\" b-if=\"response == 'confirm'\">\n      <button class=\"tc-15-btn m{{enabled ? '' : ' disabled'}}\" b-on-click=\"enabled && _confirmFilter()\">确定</button>\n      <button class=\"tc-15-btn m weak{{enabled ? '' : ' disabled'}}\" b-if=\"enableClear\" b-on-click=\"enabled && _clearFilter()\">清空</button>\n      <button class=\"tc-15-btn m weak\" b-on-click=\"_cancelFilter()\">取消</button>\n    </div>\n  </div>\n\n</div>";var Bee=_dereq_('beejs');var ComponentBase=_dereq_('../componentBase');var defaults={filterOptions:[],filterResult:null,change:null,ready:null,enableClear:false,enabled:true,response:'confirm',search:false,singleMode:false,ui:{popup:false}};var GridViewHeaderFilter=ComponentBase.extend({$tpl:tpl,$valuekey:'filterResult',$afterInit:function $afterInit(){var _this=this;if(this.change){this.$watch('filterResult',function(){return _this.change(_this.filterResult);});}
this.setFilterResult(this.filterResult||this._calcFilterResult());$(document).on('click',this._docClickHandler=function(){return _this.popupLocked||_this._popup(false);});if(this.ready){this.ready(this);}},$afterDestroy:function $afterDestroy(){$(document).off('click',this._docClickHandler);},_calcFilterResult:function _calcFilterResult(changeTarget){if(this.filterOptions){var result=[];var singleMode=this.singleMode;this.filterOptions.forEach(function(option,index,options){if(singleMode&&changeTarget){if(option.value==changeTarget.value&&option.checked){result.push(option.value);}else if(option.checked){options.$set(index,{checked:false});}}else if(option.checked){result.push(option.value);}});if(result.length){return result;}}
return null;},_updateCheckAllState:function _updateCheckAllState(){var filterResult=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];if(this.filterOptions){var hasChecked=filterResult&&filterResult.length>0;var allChecked=filterResult&&this.filterOptions.length==filterResult.length;this.$replace('hasChecked',hasChecked);this.$replace('allChecked',allChecked);}},_checkAllChange:function _checkAllChange(allChecked){var options=this.filterOptions;if(options){for(var i=0;i<options.length;i++){options.$set(i,{checked:allChecked});}}
this._filterOptionChange();},_filterOptionChange:function _filterOptionChange(changeTarget){var filterResult=this._calcFilterResult(changeTarget);if(this.response=='immediate'){this.setFilterResult(filterResult);}
this._updateCheckAllState(filterResult);},_confirmFilter:function _confirmFilter(){this.setFilterResult(this._calcFilterResult());this._popup(false);},_cancelFilter:function _cancelFilter(){this.setFilterResult(this.filterResult);this._updateCheckAllState(this.filterResult);this._popup(false);},_clearFilter:function _clearFilter(){this.setFilterResult(null);this._popup(false);},_popup:function _popup(value){this.$set('ui.popup',value);},_stopPropagation:function _stopPropagation(e){e.stopPropagation();},_togglePopup:function _togglePopup(e){var _this2=this;this._popup(!this.ui.popup);this.popupLocked=true;setTimeout(function(){return _this2.popupLocked=false;},1);},_getFilterTitle:function _getFilterTitle(){var selectedLabel=[];this.filterOptions.forEach(function(option){if(option.checked){selectedLabel.push(option.label);}});return selectedLabel.length?this.col.name+'：'+selectedLabel.join('、'):this.col.name+'：点击筛选';},_isSameArray:function _isSameArray(a,b){return JSON.stringify(a)==JSON.stringify(b);},_searchOptions:function _searchOptions(options,keyword){keyword=keyword&&keyword.toLowerCase();return this.search&&keyword?options.filter(function(option){return option.label&&option.label.toLowerCase().indexOf(keyword)>-1;}):options;},setFilterResult:function setFilterResult(result){var options=this.filterOptions;if(options){for(var i=0;i<options.length;i++){var checked=result?result.indexOf(options[i].value)>-1:false;options.$set(i,{checked:checked});}}
if(!this._isSameArray(this.filterResult,result)){this.$replace('filterResult',result);}}},{defaults:defaults});module.exports=GridViewHeaderFilter;},{"../componentBase":28,"beejs":2}],32:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"grid-view\" b-style=\"style\" b-on=\"events\">\n  <div data-grid-panel class=\"tc-15-table-panel\" b-on=\"$events\">\n    <div data-grid-head class=\"tc-15-table-fixed-head\" style=\"width:auto\"\n      b-style=\"{paddingRight: _hasYScroll ? scrollBarSize : 0}\">\n      <table b-ref=\"head\" class=\"tc-15-table-box\" style=\"min-width: 100%\">\n        <colgroup>\n          <col b-if=\"hasFirst\" b-style=\"{width: firstColWith}\">\n          <col b-repeat=\"col in shownColums\"\n            data-locked-col?=\"col.locked\"\n            b-style=\"{width: col.width || 'auto', minWidth: col.minWidth}\">\n        </colgroup>\n        <thead>\n          <tr>\n            <th b-if=\"hasFirst\">\n              <div class=\"tc-15-first-checkbox\">\n                <input type=\"checkbox\" b-model=\"ischeckAll\" data-check-all class=\"tc-15-checkbox\">\n              </div>\n            </th>\n            <th b-repeat=\"col in shownColums\"\n                class=\"text-{{col.align || 'left'}}\"\n                data-locked-th?=\"col.locked\"\n                data-orderfield=\"{{col.orderField || col.key}}\">\n              <div>\n                <span b-content=\"_getHeadContent(col)\"></span>\n              </div>\n              <i class=\"resize-line-icon\" data-role=\"resizer\"\n                b-if=\"canResizeColum && $index < shownColums.length - lockedColums.length - 1\"></i>\n            </th>\n          </tr>\n        </thead>\n      </table>\n    </div>\n    <div b-on-scroll=\"_synScroll()\" data-grid-body class=\"tc-15-table-fixed-body\"\n      b-style=\"{minHeight: minHeight,height:height, maxHeight: maxHeight}\">\n      <table b-ref=\"body\" style=\"min-width:100%\" class=\"tc-15-table-box tc-15-table-rowhover\">\n        <colgroup>\n          <col b-if=\"hasFirst\" b-style=\"{width: firstColWith}\">\n          <col b-repeat=\"col in shownColums\" data-locked-col?=\"col.locked\" b-style=\"{width: col.width || 'auto'}\">\n        </colgroup>\n        <tbody>\n          <tr b-if=\"canSelectTotal\" style=\"display:none\" data-select-total>\n            <td class=\"tc-15-news-tips-box\" colspan=\"{{countCols(colums)}}\">\n                <div b-if=\"!isSelectTotal\" class=\"text-center\"><span class=\"text\">已勾选本页{{selectedNum}}项, </span><a data-select-total-toggle href=\"javascript:;\">勾选全部页面共{{totalNum}}项</a></div>\n                <div b-if=\"isSelectTotal\" class=\"text-center\"><span class=\"text\">勾选全部页面共{{totalNum}}项, </span><a data-select-total-toggle href=\"javascript:;\">已勾选本页{{selectedNum}}项</a></div>\n            </td>\n          </tr>\n          <tr data-tips b-if=\"_tips\">\n            <td class=\"text-center\" colspan=\"{{countCols(colums)}}\">\n                <div>{{> _tips }}</div>\n            </td>\n          </tr>\n          <tr data-search-tips b-if=\"searchKey\">\n            <td class=\"text-center\" colspan=\"{{countCols(colums)}}\">\n                <div b-if=\"totalNum\"><span class=\"text\">搜索\"{{searchKey}}\"，找到{{totalNum}}条结果。</span><a data-restore href=\"javascript:;\">返回原列表</a></div>\n                <div b-if=\"!totalNum\"><span class=\"text\">抱歉，没有找到相关{{ searchItemName }}，尝试其他搜索条件。</span><a data-restore href=\"javascript:;\">返回原列表</a></div>\n            </td>\n          </tr>\n          <tr data-index=\"{{$index}}\" track-by=\"{{trackKey}}\" b-ref=\"list\" b-repeat=\"item in list\"\n            b-attr=\"setTrAttr(trAttr, item)\"\n            class=\"item-row {{selectedHighlight && item.$selected ? 'current' : ''}}\n              {{item.$disable ? 'disable': ''}} {{item.$class || ''}}\">\n            <td b-if=\"hasFirst\">\n              <div class=\"tc-15-first-checkbox\">\n                <i b-if=\"item.$loading\" class=\"n-loading-icon\"></i>\n                <input class=\"tc-15-checkbox\" disabled?=\"item.$disable || item.$disableCheckbox\"\n                  data-checkbox\n                  b-if=\"!item.$loading\" type=\"checkbox\" b-model=\"item.$selected\">\n              </div>\n            </td>\n            <td b-repeat=\"col in shownColums\"\n                class=\"text-{{col.align || 'left'}}\">\n              <div>\n                <span b-content=\"_getCellContent(item[col.key], item, col)\"></span>\n              </div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <!-- 固定列 -->\n      <div data-locked b-if=\"lockedColums.length\" class=\"fixed-column\"\n        b-class=\"{'fixed-column-shadow': '_hasXScroll'}\"\n        style=\"opacity:1; right: 0px; top: 0px;\"\n        b-style=\"{width: _hasYScroll ? (lockedWidth + scrollBarSize) : lockedWidth}\">\n          <div data-grid-head class=\"tc-15-table-fixed-head\" style=\"width: auto\"\n            b-style=\"{paddingRight: _hasYScroll ? scrollBarSize : 0}\">\n              <table class=\"tc-15-table-box\">\n                <colgroup>\n                  <col b-repeat=\"col in lockedColums\" b-style=\"{width: col.width || 'auto'}\">\n                </colgroup><thead>\n                  <tr>\n                      <th b-repeat=\"col in lockedColums\"\n                          data-orderfield=\"{{col.orderField || col.key}}\">\n                        <div>\n                          <span b-content=\"_getHeadContent(col)\"></span>\n                        </div>\n                        <!-- <i class=\"resize-line-icon\" data-role=\"resizer\" b-if=\"canResizeColum && $index < lockedColums.length - 1\"></i> -->\n                      </th>\n                  </tr>\n                </thead></table>\n          </div>\n          <!-- ie 8 的 max-height 包含了滚动条 -->\n          <div data-grid-body  b-on-scroll=\"__synScroll()\" class=\"tc-15-table-fixed-body\"\n            style=\"border-bottom: none;overflow-x:hidden\"\n            b-style=\"{\n              minHeight: _hasXScroll && _ie != 8 ? minHeight - scrollBarSize : minHeight,\n              height: _hasXScroll && _ie != 8 ? height - scrollBarSize : height,\n              maxHeight: _hasXScroll && _ie != 8 ? maxHeight - scrollBarSize : maxHeight\n            }\">\n              <table class=\"tc-15-table-box tc-15-table-rowhover\">\n                <colgroup>\n                  <col b-repeat=\"col in lockedColums\" b-style=\"{width: col.width || 'auto'}\">\n                </colgroup>\n                <tbody>\n                  <tr data-select-total b-if=\"canSelectTotal\" style=\"display:none\">\n                    <td class=\"tc-15-news-tips-box\" colspan=\"{{lockedColums.length}}\"></td>\n                  </tr>\n                  <tr data-tips b-if=\"_tips\">\n                    <td class=\"text-center\" colspan=\"{{lockedColums.length}}\"></td>\n                  </tr>\n                  <tr data-search-tips b-if=\"searchKey\">\n                    <td class=\"text-center\" colspan=\"{{lockedColums.length}}\"></td>\n                  </tr>\n                  <tr data-index=\"{{$index}}\" track-by=\"{{trackKey}}\" b-ref=\"lockedList\" b-repeat=\"item in list\"\n                    b-attr=\"setTrAttr(trAttr, item)\"\n                    class=\"item-row {{selectedHighlight && item.$selected ? 'current' : ''}}\n                      {{item.$disable ? 'disable': ''}} {{item.$class || ''}}\">\n                    <td b-repeat=\"col in lockedColums\">\n                      <div>\n                        <span b-content=\"_getCellContent(item[col.key], item, col)\"></span>\n                      </div>\n                    </td>\n                  </tr>\n              </tbody></table>\n          </div>\n      </div>\n  </div>\n\n  <div data-pager class=\"tc-15-page\" b-if=\"showState || showPagination\">\n    <div class=\"tc-15-page-state\" b-if=\"showState\">\n      <span class=\"tc-15-page-text\"><span b-template b-if=\"hasFirst\">已选<strong>{{selectedNum}}</strong>项，</span>共<strong>{{totalNum}}</strong>项</span>\n    </div>\n    <div b-tag=pagination b-ref=\"pager\" b-if=\"showPagination\" b-with='{listFn: listFn.bind(this), page: page, count: count, totalNum: totalNum, demo: demo, keyword: keyword,\n      pageInterval: pageInterval,\n      countInterval: countInterval,\n      minCount: minCount,\n      maxCount: maxCount,\n      loading: loading\n      }'></div>\n  </div>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var Pagenation=_dereq_('../pagination');var getScrollBarSize=_dereq_('./lib/scroll-bar-size').getScrollBarSize;var getWidthWithoutScroll=_dereq_('./lib/scroll-bar-size').getWidthWithoutScroll;var defaults={hasFirst:true,firstColWith:'50px',selectedHighlight:true,canSelectTotal:false,isSelectTotal:false,canResizeColum:true,colMinWidth:100,maxHeight:'auto',height:'auto',minHeight:350,autoMaxHeight:true,maxHeightOffset:1,orderField:'',order:1,showPagination:true,count:20,page:1,totalNum:0,showState:true,shownColums:[],colums:[],list:[],trackKey:'',trAttr:{},emptyTips:'列表为空',searchKey:'',searchItemName:'结果',searchEmptyTips:'',initGetData:true,loading:false,scrollBaseSize:0,_ie:Bee.utils.ie};var GridView=Base.extend({$tpl:tpl,$afterInit:function $afterInit(){var _this=this;GridView.__super__.$afterInit.call(this);this._$el=$(this.$el);this.$gridHead=this._$el.find('[data-grid-head]');this.$gridBody=this._$el.find('[data-grid-body]');this.$set('scrollBarSize',getScrollBarSize('def-scoll'));this.bindEvent();this.autoMaxHeight&&this.setMaxHeight();setTimeout(function(){return _this.initGetData&&_this.listFn();},0);},actionKey:'_action',actionTpl:'<span class="text-overflow"><a href="javascript:;" class="links">删除</a></span>',extraParam:{},offsetHeight:0,countCols:function countCols(colums){var colSize=colums.filter(function(col){return!col.hide;}).length;return colSize+!!this.$root.hasFirst;},setTrAttr:function setTrAttr(obj,item){var attr={};for(var key in obj){attr[key]=item[obj[key]];}
return attr;},getData:function getData(opts,callback){},refresh:function refresh(cb){cb=cb||function(){};this.listFn(this.latestParam,cb);},listFn:function listFn(opts,cb){var param=$.extend({},this.$data,opts);var that=this;cb=cb||function(){};if(this.loading){return;}
this.$set('loading',true);this.latestParam=$.extend({},this.extraParam,{orderField:param.orderField,order:param.order,page:param.page,count:param.count,searchKey:param.searchKey});this.getData(this.latestParam,function(){that.$dataCallback.apply(that,arguments);that.$set('loading',false);cb();});},setExtraParam:function setExtraParam(extraParam){this.extraParam=extraParam||{};},setData:function setData(data){this.$checkAll(false);this.list.forEach(function(item,i,arr){arr.$set(i,{$selected:false});});var opts=$.extend(true,{loading:false},this.latestParam,data);this.hideTips();if(!opts.searchKey&&!opts.list.length){this.showTips(this.emptyTips);}
this.$set(opts);this.autoMaxHeight&&this.setMaxHeight();},setColums:function setColums(colums){this.$replace('colums',colums);},updateItem:function updateItem(index,item){this.$refs.list[index].$set(item);this.$refs.lockedList&&this.$refs.lockedList[index].$set(item);},removeItem:function removeItem(index){this.list.splice(index,1);},_getHeadContent:function _getHeadContent(col){var tpl;tpl=this.$root.getHeadContent(col)||col.thTpl;if(!tpl){tpl='<span b-if="col.order" data-order class="tc-15-th-sort-btn {{orderField === (col.orderField || col.key) ? \'current\': \'\'}}">\n          <span class="text-overflow">{{col.name}}</span>\n          <i class="{{orderField === (col.orderField || col.key) ? (order == 0 ? \'down-sort-icon\' : \'up-sort-icon\') : \'sort-icon\'}}"></i>\n        </span>\n        <span b-if="!col.order" class="text-overflow">{{col.name}}</span>';}
return tpl;},getHeadContent:function getHeadContent(col){},_getCellContent:function _getCellContent(val,item,col){var tpl=this.$root.getCellContent(val,item,col)||col.tdTpl;if(!tpl){if(col.key===this.actionKey){tpl=typeof this.actionTpl==='function'?this.actionTpl(item,col):this.actionTpl;}else{tpl='<span class="text-overflow" title="{{col.name}}：{{item[col.key]}}">\n         {{{(typeof item[col.key] === "undefeind" || item[col.key] === "") ? "-" : item[col.key]}}}</span>';}}
return tpl;},getCellContent:function getCellContent(val,item,col){},showLoading:function showLoading(text,hideList){text=text||'加载中';this.showTips('<i class="n-loading-icon"></i> <span class="text">'+text+'</span>');if(hideList){$(this.$el).find('tr.item-row').css({'opacity':0.65,'pointer-events':'none'});}},hideLoading:function hideLoading(){$(this.$el).find('tr[data-tips] i.n-loading-icon').length&&this.hideTips();$(this.$el).find('tr.item-row').css({'opacity':1,'pointer-events':'all'});},showTips:function showTips(content){this.$set('_tips',content);},hideTips:function hideTips(){this.$set('_tips','');},showSelectAllTips:function showSelectAllTips(tr){$(tr).show();},hideSelectAllTips:function hideSelectAllTips(tr){$(tr).hide();},getSelected:function getSelected(){return this.list.filter(function(item){return item.$selected;});},setMaxHeight:function setMaxHeight(){var $gridFooter=this._$el.find('[data-pager]');var maxHeight=$(window).height()-(this.$gridHead.outerHeight()+$gridFooter.outerHeight()+40)-this.$gridHead.offset().top-this.maxHeightOffset;if(this._$el.filter(':visible').length){this.$set({maxHeight:maxHeight});this._$el.find('[data-grid-panel]').css('height',this.$gridBody.outerHeight()+this.$gridHead.outerHeight());this.$set({_hasYScroll:this.$gridBody[0].scrollHeight>this.$gridBody[0].clientHeight,_hasXScroll:this.$gridBody[0].scrollWidth>this.$gridBody[0].clientWidth});}},checkWidth:function checkWidth(){var hasAuto=false;this.$gridHead.find('col').each(function(){if(this.style.width=='auto'){hasAuto=true;}});if(!hasAuto){this.$lastCol.width('auto');}
$(this.$refs.head).add($(this.$refs.body)).width('');this.checkCellWidth();},checkCellWidth:function checkCellWidth(){var _this2=this;var tableWidth;var $ths=this.$gridHead.find('th');if(!this._$el.is(':visible')){return;}
$ths.each(function(i,th){var $th=$(th);var width=$th.width();if(_this2.hasFirst&&i==0){return;}
var col=_this2.getColByIndex(i);var minWidth=col.minWidth||_this2.colMinWidth;if(minWidth>width){_this2.setCellWidth(i,width);}});tableWidth=$(this.$refs.head).width();if(tableWidth>this.$gridHead.width()){$(this.$refs.head).width(tableWidth);$(this.$refs.body).width(tableWidth);}
var lockedWidth=0;$ths.filter('[data-locked-th]').each(function(i,th){var width=$(th).width();lockedWidth+=width;});this.$set('lockedWidth',lockedWidth);},resize:function resize(){this.checkCellWidth();if(this.autoMaxHeight){this._$el.is(':visible')&&this.setMaxHeight();}
if(this.resizeAutoWidth){this.$lastCol.width('auto');}},backList:function backList(){this.listFn({page:1,count:this.count,order:this.order,orderField:this.orderField,searchKey:false});},bindEvent:function bindEvent(){var _this3=this;this.$watch('colums',function(){var shownColums=this.colums.filter(function(col){return!col.hide;});this.$set({'shownColums':shownColums,'lockedColums':shownColums.filter(function(col){return col.locked;})});this.$locked=this._$el.find('[data-locked]');this.$lockedHead=this.$locked.find('[data-grid-head]');this.$lockedBody=this.$locked.find('[data-grid-body]');this._setLastCol();this.checkWidth();this.autoMaxHeight&&this.setMaxHeight();},true);this.$watch('list',function(){return _this3.$checkAll();});this.$watch('list.length',function(length){if(!_this3.searchKey){if(!length){_this3.showTips(_this3.emptyTips);}else{if(_this3._tips==_this3.emptyTips){_this3.hideTips();}}}});this.$watch('getSelected(list).length',function(length){length=this.getSelectedLength?this.getSelectedLength():length;this.$set('selectedNum',length);});this.$watch('ischeckAll',function(val){val||this.$set('isSelectTotal',false);},true);$(window).on('resize',function(){_this3.resize();});this._$el.on('mouseenter mouseleave','[data-grid-body]>table>tbody>tr, [data-locked] [data-grid-body]>table>tbody>tr',function(e){if(_this3.lockedColums.length){var $tr=$(e.currentTarget);var index=$tr.index();var action=e.type==='mouseenter'?'addClass':'removeClass';_this3._$el.find('[data-grid-body]>table>tbody>tr').eq(index)[action]('tr-hover');_this3._$el.find('[data-locked] [data-grid-body]>table>tbody>tr').eq(index)[action]('tr-hover');}});},$events:{"click th [data-order]":function clickThDataOrder(e){var orderField=$(e.currentTarget).closest('th').attr('data-orderfield');var order;var that=this;if(orderField===this.orderField){order=1-this.order;}else{order=1;}
this.listFn({'orderField':orderField,order:order});},"mousedown [data-role=resizer]":function mousedownDataRoleResizer(e){var index=$(e.currentTarget).closest('th').index();this.__draging=true;this.__dragingIndex=index;this.__$col=$(this.$el).find('[data-grid-body] col').eq(index).add($(this.$el).find('[data-grid-head] col').eq(index));this.__originlWidth=$(e.currentTarget).closest('th').width();this.__lastWidth=this.__originlWidth;this.__originalX=e.clientX;e.preventDefault();this._dragEventBind();$('body').css('cursor','e-resize');},"change [data-check-all]":function changeDataCheckAll(e){var _this4=this;var checked=e.target.checked;this.list.forEach(function(item,i,arr){if(!item.$disable&&!item.$loading&&!item.$disableCheckbox){_this4.updateItem(i,{'$selected':checked});}});if(!this.list.filter(function(item){return item.$disable||item.$loading||item.$disableCheckbox;}).length){var tr=this._$el.find('[data-select-total]');checked?this.showSelectAllTips(tr):this.hideSelectAllTips(tr);}},"change input:checkbox[data-checkbox]":function changeInputCheckboxDataCheckbox(e){if(this.lockedColums.length){var index=$(e.target).closest('tr').attr('data-index');var selected=e.target.selected;this.updateItem(index,{$selected:selected});}},"click a[data-restore]":function clickADataRestore(){this.backList();},"click [data-select-total-toggle]":function clickDataSelectTotalToggle(){var selectTotal=!this.isSelectTotal;this.$set('isSelectTotal',selectTotal);}},_synScroll:function _synScroll(){$(this.$refs.head).css({'left':-this.$gridBody[0].scrollLeft});if(this.lockedColums.length){this.$lockedBody[0].scrollTop=this.$gridBody[0].scrollTop;}},__synScroll:function __synScroll(){this.$gridBody[0].scrollTop=this.$lockedBody[0].scrollTop;},_dragEventBind:function _dragEventBind(){var that=this;$(document).off('mouseup.grid_view').on('mouseup.grid_view',function(){if(that.__draging){that.__draging=false;$(this).off('mousemove.grid_view');$('body').css('cursor','');delete that.__$col;delete that.__lastWidth;delete that.__dragingIndex;that.autoMaxHeight&&that.setMaxHeight();}}).on('mousemove.grid_view',function(e){var offset,width,curGridWidth;if(that.__draging){offset=e.clientX-that.__originalX;width=that.__originlWidth*1+offset;that.setCellWidth(that.__dragingIndex,width);e.preventDefault();}});},setCellWidth:function setCellWidth(index,width){var col=this.getColByIndex(index);var minWidth=col.minWidth||this.colMinWidth;var lastMinWidth=this.shownColums[this.shownColums.length-this.lockedColums.length-1].minWidth||this.colMinWidth;if(width<minWidth){width=minWidth;}
var curGridWidth=$(this.$refs.body).width();var $col=this.__$col||this.$gridHead.find('col').eq(index).add(this.$gridBody.find('col').eq(index));var lastWidth=this.__lastWidth;var offset=width-lastWidth;var curLastColWidth=this.$gridHead.find('th:not([data-locked-th]):last').width();if(offset<0&&$(this.$refs.head).width()>this.$gridHead.width()||offset>0&&curLastColWidth-offset<=lastMinWidth){$(this.$refs.head).width(curGridWidth+offset);$(this.$refs.body).width(curGridWidth+offset);}else{if(offset<0||curLastColWidth-offset>lastMinWidth){this.$lastCol.width(curLastColWidth-offset);}}
$col.width(width);if(this.__lastWidth){this.__lastWidth=width;}},getColByIndex:function getColByIndex(index){if(this.hasFirst){index--;}
return this.shownColums[index];},$checkAll:function $checkAll(checked){var list=this.$get('list');var _checked;if(typeof checked!=='boolean'){checked=!list.filter(function(item){if(item.$selected){_checked=true;}
return!item.$selected&&!item.$disable&&!item.$loading&&!item.$disableCheckbox;}).length&&_checked;}
this.$set('ischeckAll',checked);checked||this.$root.hideSelectAllTips(this._$el.find('[data-select-total]'));},$dataCallback:function $dataCallback(err,data){if(err){}else{this.setData(data);}},$getNoDataHtml:function $getNoDataHtml(){var noDataHtml=this.keyword?this.searchNoData:this.filterNoData;return noDataHtml;},_setLastCol:function _setLastCol(){this.$lastCol=this.$gridHead.find('col:not([data-locked-col]):last').add(this.$gridBody.find('col:not([data-locked-col]):last'));}},{defaults:defaults});module.exports=GridView;},{"../componentBase":28,"../pagination":35,"./lib/scroll-bar-size":33,"beejs":2}],33:[function(_dereq_,module,exports){"use strict";exports.getScrollBarSize=function getScrollBarSize(className){var inner=document.createElement('p');inner.style.width="100%";inner.style.height="200px";var outer=document.createElement('div');outer.style.position="absolute";outer.style.top="0px";outer.style.left="0px";outer.style.visibility="hidden";outer.style.width="200px";outer.style.height="150px";outer.style.overflow="hidden";outer.className=className||'';outer.appendChild(inner);document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow='scroll';var w2=inner.offsetWidth;if(w1==w2)w2=outer.clientWidth;document.body.removeChild(outer);return w1-w2;};},{}],34:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"input-slider\"  class=\"num\" b-on=\"$events\" style=\"display:inline-block\" b-style=\"style\">\n  <span class=\"number-input-decoration\">\n    <input b-ref=\"input\" data-input b-model=\"value\" class=\"tc-input-text\" type=\"text\">\n    <span class=\"arrows\">\n        <a href=\"javascript:;\" data-down>\n            <i class=\"sequence\"></i>\n        </a>\n        <i class=\"line\"></i>\n        <a href=\"javascript:;\" data-up>\n            <i class=\"sequence desc\"></i>\n        </a>\n    </span>\n  </span>\n  <div b-ref='slider' class=\"ui_progress\" style=\"display:none\">\n    <div class=\"progress_area\">\n        <div b-ref=\"sliderBar\" class=\"progress_bar\">\n            <div class=\"progress_bg\">\n                <div class=\"progress_in\"\n                  b-style=\"{width: Math.max(0, Math.min(100, ((value - min) / (max - min)) * 100)) + '%'}\">\n                </div>\n                <a data-handler href=\"javascript:;\" class=\"btn_drag\"\n                   b-style=\"{left: Math.max(0, Math.min(100, ((value - min) / (max - min)) * 100)) + '%' }\"></a>\n            </div>\n        </div>\n    </div>\n  </div>\n</div>\n";var Bee=_dereq_('beejs');var SliderRange=_dereq_('../slider-range');var InputSlider=SliderRange.extend({$tpl:tpl,showSlider:function showSlider(){$(this.$refs.slider).show();},hideSlider:function hideSlider(){$(this.$refs.slider).hide();},$events:{'click [data-input]':function clickDataInput(e){this.showSlider();e.target.select();},'click [data-up]':function clickDataUp(){this.stepUp();},'click [data-down]':function clickDataDown(){this.stepDown();},'keydown':function keydown(e){if(e.keyCode==37||e.keyCode==40){this.stepDown();e.preventDefault();}else if(e.keyCode==38||e.keyCode==39){this.stepUp();e.preventDefault();}}},$afterInit:function $afterInit(){InputSlider.__super__.$afterInit.call(this);var that=this;var $body=$('body');$body.on('click.slider_'+this.guid,function(e){if(e.target===that.$refs.slider||$(that.$refs.slider).find(e.target).length||e.target===that.$refs.input){return;}
that.hideSlider();});}});module.exports=InputSlider;},{"../slider-range":47,"beejs":2}],35:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"pagination\" class=\"tc-15-page-operate\" b-on=\"$events\">\n    <div b-template b-if=\"totalNum\">\n    <span class=\"tc-15-page-text\">每页显示行</span>\n    <div class=\"tc-15-page-select\" data-page-select>\n        <a class=\"indent\" href=\"javascript:;\">{{count}}<span class=\"ico-arrow\"></span></a>\n        <ul data-list class=\"tc-15-simulate-option tc-15-def-scroll\">\n            <li data-count=\"{{c}}\" b-repeat=\"c in setCountList(totalNum)\">{{c}}</li>\n        </ul>\n    </div>\n    <a data-page=\"1\" class=\"tc-15-page-first {{page<=1?'disable':''}}\" title=\"第一页\" href=\"javascript:;\"></a>\n    <a data-page=\"{{page-1}}\" class=\"tc-15-page-pre {{page<=1?'disable':''}}\" title=\"上一页\" href=\"javascript:;\"></a>\n    <div class=\"tc-15-page-select\" data-page-select disable?='lastPage==1'>\n        <a class=\"tc-15-page-num\" href=\"javascript:;\">{{page}}/{{lastPage}}<span b-if=\"lastPage>1\" class=\"ico-arrow\"></span></a>\n        <ul class=\"tc-15-simulate-option tc-15-def-scroll\">\n            <li title=\"前往第{{p}}页\" data-page=\"{{p}}\" b-repeat=\"p in setPageList(totalNum, count)\">{{p}}</li>\n        </ul>\n    </div>\n    <a data-page=\"{{page*1+1}}\" class=\"tc-15-page-next {{page==lastPage?'disable':''}}\" title=\"下一页\" href=\"javascript:;\"></a>\n    <a data-page=\"{{lastPage}}\" class=\"tc-15-page-last {{page==lastPage?'disable':''}}\" title=\"最后一页\" href=\"javascript:;\"></a>\n    </div>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var Pagination=Base.extend({constructor:function constructor(){var that=this;Base.apply(this,arguments);this.bindEvent();},$beforeInit:function $beforeInit(){Pagination.__super__.$beforeInit.call(this);this.originalCount=this.count;},$tpl:tpl,$data:{pageInterval:1,countInterval:5,minCount:10,maxCount:50,totalNum:0,page:1,count:20,lastPage:1,demo:false},selectedClass:'tc-15-page-selected',listFn:function listFn(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];console.log(opts);console.log('实现接口接受翻页参数');},_listFn:function _listFn(opts){var _this=this;if(!this.loading){this.loading=true;this.listFn(opts,function(){_this.loading=false;});}},listToggle:function listToggle($box,type){if(type!==false){type=!$box.hasClass(this.selectedClass);}
if(type){$box.addClass(this.selectedClass);$box.children('[data-list]').show();}else{$box.removeClass(this.selectedClass);$box.children('[data-list]').hide();}},setPageList:function setPageList(totalNum,count){var page=1;var arr=[];var max=Math.ceil(totalNum/count);while(page<=max){arr.push(page);page+=this.pageInterval;}
this.$set({'lastPage':max,page:Math.min(this.page||1,max)});return arr.reverse();},setCountList:function setCountList(totalNum){var a=[];var count=this.minCount*1;while(count<=Math.max(this.minCount*1,Math.min(this.maxCount*1,totalNum*1+this.countInterval*1-1),this.originalCount)){a.push(count);count+=this.countInterval*1;}
return a.reverse();},bindEvent:function bindEvent(){var that=this;$(document).on('click',function(e){var $box=$(that.$el).find('[data-page-select]');that.listToggle($box.not(e.target).not($(e.target).closest('[data-page-select]')),false);});},$events:{'click [data-page-select]:not([disable]) a':function clickDataPageSelectNotDisableA(e){this.listToggle($(e.currentTarget).parent());},'click [data-page]':function clickDataPage(e){var $el=$(e.target);var page;if($el.hasClass('disable')){return;}
page=$el.attr('data-page')*1||this.page;this.demo&&this.$set({page:page});this.listToggle($(e.target).closest('[data-page-select]'));this._listFn({page:page,count:this.count});},'click [data-count]':function clickDataCount(e){var count=$(e.target).attr('data-count')*1;this.demo&&this.$set('count',count);this.listToggle($(e.target).closest('[data-page-select]'));this._listFn({page:1,count:count});}}});module.exports=Pagination;},{"../componentBase":28,"beejs":2}],36:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"qc-popover\" style=\"display:none;\" b-style=\"style\" class=\"tc-15-confirm-popout {{_getPosClass(position)}}\">\n    <div class=\"tc-15-confirm-popout-bd\">\n        <p class=\"tc-15-msg\"><strong>{{title}}</strong>\n          <br b-if=\"content\">\n          {{> content }}\n        </p>\n    </div>\n    <div class=\"tc-15-confirm-popout-ft\">\n        <button class=\"tc-15-btn m\" b-on-click=\"hide(true)\">{{confirmKey}}</button>\n        <button class=\"tc-15-btn m weak\" b-on-click=\"hide()\">{{cancelKey}}</button>\n    </div>\n</div>\n";var Bee=_dereq_('beejs');var QCPopover=_dereq_('../qc-popover');var classes={top:'tc-15-confirm-popout-bottom',bottom:'tc-15-confirm-popout-top','top left':'tc-15-confirm-popout-bottom align-end','top right':'tc-15-confirm-popout-bottom align-start','bottom left':'tc-15-confirm-popout-top align-end','bottom right':'tc-15-confirm-popout-top align-start'};var PopupConfirm=QCPopover.extend({$tpl:tpl,_getPosClass:function _getPosClass(position){return classes[position]||'';},hide:function hide(isConfirm){var _this=this;var result=isConfirm?this.onConfirm():this.onCancel();if(result===false){return;}
if(result&&result.then){result.then(function(){PopupConfirm.__super__.hide.call(_this);});}else{PopupConfirm.__super__.hide.call(this);}},onConfirm:function onConfirm(){},onCancel:function onCancel(){}},{defaults:{availablePos:['top left','top right','top','bottom left','bottom right','bottom'],trigger:'click',arrowPad:30,confirmKey:'确定',cancelKey:'取消',style:'width: auto',position:'bottom left'}});PopupConfirm.bootFromAttr('popup-confirm');module.exports=PopupConfirm;},{"../qc-popover":42,"beejs":2}],37:[function(_dereq_,module,exports){'use strict';var tpl="<button\n  b-on=\"$events\"\n  class=\"tc-15-btn m{{className ? ' ' + className : ''}}{{disabled ? ' disabled' : ''}}\"\n  tabindex=\"0\" b-attr=\"attr\">{{label}}\n</button>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var Event=_dereq_('beejs/addons/event');var QCActionButton=Base.extend({$tpl:tpl,$events:{'click':function click(){this._executeAction();}},_executeAction:function _executeAction(){if(this.disabled)return;if(typeof this.action=='function'){this.action(this);}
this.$emit('action',this.$data);},setEnable:function setEnable(enable){this.$set('disabled',!enable);},enable:function enable(){this.setEnable(true);},disable:function disable(){this.setEnable(false);}},{defaults:{disabled:false,attr:{}}});module.exports=QCActionButton;},{"../componentBase":28,"beejs":2,"beejs/addons/event":1}],38:[function(_dereq_,module,exports){'use strict';var tpl="<div class=\"tc-15-action-panel action-panel-root\" b-on=\"handle()\">\n  <div\n    b-repeat=\"widget in widgets\"\n    data-widget-type=\"{{widget.type}}\"\n    data-widget-name=\"{{widget.name}}\"\n    b-style=\"{ float: widget.float || 'left'}\">\n\n    <!-- widget type: date-picker -->\n    <div b-tag=\"qc-date-picker\" b-if=\"widget.type == 'date-picker'\" b-with=\"widget\"></div>\n\n    <!-- widget type: action -->\n    <div b-tag=\"qc-action-button\" b-if=\"widget.type == 'action'\" b-with=\"widget\">{{widget.label}}</div>\n\n    <!-- widget type: action-list -->\n    <div b-tag=\"qc-dropdown-list\" b-if=\"widget.type == 'action-list'\" b-with=\"widget\"></div>\n\n    <!-- widget type: seperator -->\n    <div b-if=\"widget.type == 'seperator'\" class=\"tc-15-v-sep\" role=\"separator\"></div>\n\n    <!-- widget type: filter-expander -->\n    <button\n      b-if=\"widget.type == 'filter-expander'\"\n      class=\"tc-15-btn weak m for-select{{widget.expand ? ' show' : ''}}\">{{widget.label}}\n    </button>\n\n    <!-- widget type: search -->\n    <div b-tag=\"qc-search\" b-if=\"widget.type == 'search'\" b-with=\"widget\"></div>\n\n    <!-- widget type: filter-panel -->\n    <div\n      b-if=\"widget.type == 'filter-panel'\"\n      b-style=\"{ display: widget.expand ? 'block' : 'none' }\"\n      class=\"tc-15-action-select-panle\">\n\n      <div class=\"param-line\" b-repeat=\"param in widget.params\" data-param=\"{{param.key}}\">\n        <strong>{{param.label}}</strong>\n        <p>\n          <span class=\"param-option\" data-role=\"select-all\">\n            <label>\n              <input type=\"checkbox\" class=\"tc-15-checkbox\" b-model=\"param.all\" />{{param.allLabel || '全部'}}\n            </label>\n          </span>\n          <span class=\"param-option\" b-repeat=\"option in param.options\">\n            <label>\n              <input type=\"checkbox\" class=\"tc-15-checkbox\" b-model=\"option.checked\" />{{option.label}}\n            </label>\n          </span>\n        </p>\n      </div>\n\n      <div class=\"tc-15-action-select-panle-btns\">\n        <button class=\"tc-15-btn m\" data-role=\"accept\">确定</button>\n        <button class=\"tc-15-btn m weak\" data-role=\"cancel\">取消</button>\n      </div>\n    </div>\n\n    <!-- widget type: filter-result-tag-list -->\n    <div\n      b-if=\"widget.type == 'filter-result-tag-list' && widget.visible && widget.result.length\"\n      class=\"tc-15-tag-list\">\n      <div class=\"tc-15-tag\" tabindex=\"0\"\n        b-repeat=\"param in widget.result\"\n        data-clear-param=\"{{param.key}}\">{{param.label}}：{{param.optionsText}}\n        <span class=\"tc-15-btn-close\"></span>\n      </div>\n      <div class=\"tc-15-tag-clear\" data-role=\"clear-options\" role=\"button\" tabindex=\"0\" b-if=\"widget.result.length\">清空筛选项</div>\n    </div>\n  </div>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var Event=_dereq_('beejs/addons/event');_dereq_('../qc-action-button');_dereq_('../qc-date-picker');_dereq_('../qc-dropdown-list');_dereq_('../qc-search');var filterSessionStates={};var QCActionPanel=Base.extend({$tpl:tpl,$data:{widgets:[]},findWidgetByName:function findWidgetByName(name){var $wrapper=$(this.$el).find('div[data-widget-name="'+name+'"]');var $inner=$wrapper.children();var widgetBee=$inner.prop('bee');return widgetBee||$wrapper.prop('bee');},handle:function handle(){var handler={};var selector={'action-list-expand':'click div[data-widget-type="action-list"] button.tc-15-simulate-select','action-list-execute':'click div[data-widget-type="action-list"] ul.tc-15-simulate-option li','action-list-mask':'click div.popup-mask','search':'click div[data-widget-type="search"] button.search','filter-expand':'click div[data-widget-type="filter-expander"]','filter-option-change':'change div[data-widget-type="filter-panel"] span.param-option','filter-accept':'click div[data-widget-type="filter-panel"] button[data-role="accept"]','filter-cancel':'click div[data-widget-type="filter-panel"] button[data-role="cancel"]','filter-param-clear':'click div[data-widget-type="filter-result-tag-list"] .tc-15-tag','filter-clear':'click div[data-widget-type="filter-result-tag-list"] div[data-role="clear-options"]'};var component=this;var findWidget=function findWidget(context){if(context.currentTarget){return $(context.currentTarget).closest('div[data-widget-type]').prop('bee');}else if(typeof context=='string'){return $(component.$el).find('div[data-widget-type="'+context+'"]').prop('bee');}};var handle=function handle(name,fn){handler[selector[name]]=fn;};var updateFilterResult=function updateFilterResult(filterWidget){var result=filterWidget.result={};filterWidget.params.forEach(function(param){var paramResult=result[param.key]={};paramResult.all=!!param.all;paramResult.selected=[];param.options.forEach(function(option){if(option.checked){paramResult.selected.push(option.value);}});});};var fillParamCheckState=function fillParamCheckState(paramBee,checkState){paramBee.$replace('param.options',paramBee.options.map(function(option){option=JSON.parse(JSON.stringify(option));option.checked=checkState;return option;}));paramBee.$replace('param.all',checkState);};var setFilterExpandState=function setFilterExpandState(expanded){var filterExpander=findWidget('filter-expander');var filterPanel=findWidget('filter-panel');var filterResultTagList=findWidget('filter-result-tag-list');if(filterExpander){filterExpander.$replace('widget.expand',expanded);}
if(filterPanel){filterPanel.$replace('widget.expand',expanded);}
if(filterResultTagList){findWidget('filter-result-tag-list').$replace('widget.visible',!expanded);}};var clone=function clone(json){return JSON.parse(JSON.stringify(json));};var equal=function equal(obj1,obj2){return JSON.stringify(obj1)==JSON.stringify(obj2);};var updateFilterTagList=function updateFilterTagList(filterWidget){var tagListWidget=findWidget('filter-result-tag-list');var result=[];var params=filterWidget.params.slice();params.sort(function(a,b){return a.modifyTime-b.modifyTime;});params.forEach(function(param){var options=[];param.options.forEach(function(option){if(option.checked){options.push(option.label);}});if(!options.length)return;result.push({label:param.label,key:param.key,optionsText:options.join(', ')});});tagListWidget.$replace('widget.result',result);};var saveFilterSessionState=function saveFilterSessionState(filterWidget){if(filterWidget.sessionKey&&filterWidget.lastState){filterSessionStates[filterWidget.sessionKey]=clone(filterWidget.lastState);}};var restoreFilterSessionState=function restoreFilterSessionState(filterWidget){if(filterWidget.sessionKey&&filterSessionStates[filterWidget.sessionKey]){return filterSessionStates[filterWidget.sessionKey];}
return filterWidget.params;};var saveFilterState=function saveFilterState(filterWidget){if(!equal(filterWidget.lastState,filterWidget.params)){filterWidget.lastState=clone(filterWidget.params);updateFilterResult(filterWidget);if(filterWidget.change){filterWidget.change.call(filterWidget,filterWidget);}
updateFilterTagList(filterWidget);}
saveFilterSessionState(filterWidget);};var installInitState=function installInitState(filterWidget){var initState=restoreFilterSessionState(filterWidget);filterWidget.reset=function(){this.$replace('widget.params',clone(initState));updateFilterResult(this);updateFilterTagList(this);};filterWidget.reset();};var installCommonInitState=function installCommonInitState(widget){if(widget){var initState=clone(widget.$data);widget.reset=function(){this.$set(clone(initState));};}};var restoreFilterState=function restoreFilterState(filterWidget){if(!equal(filterWidget.lastState,filterWidget.params)){filterWidget.$replace('widget.params',clone(filterWidget.lastState));return true;}
return false;};this.$afterInit=function(){var filterWidget=findWidget('filter-panel');if(filterWidget){setFilterExpandState(false);installInitState(filterWidget);saveFilterState(filterWidget);}
installCommonInitState(component.findWidgetByName('search'));installCommonInitState(component.findWidgetByName('date-picker'));};handle('filter-expand',function(e){var expandState=findWidget(e).$get('widget.expand');setFilterExpandState(!expandState);});handle('filter-option-change',function(e){var $paramEl=$(e.currentTarget);var paramBee=$paramEl.closest('.param-line').prop('bee');var allChecked;if($paramEl.data('role')=='select-all'){allChecked=paramBee.$get('param.all');fillParamCheckState(paramBee,allChecked);}
else{allChecked=true;for(var i=0;i<paramBee.options.length;i++){if(!paramBee.options[i].checked){allChecked=false;}}
paramBee.$replace('param.all',allChecked);}
paramBee.$replace('param.modifyTime',+new Date());});handle('filter-accept',function(e){var filterWidget=findWidget(e);saveFilterState(filterWidget);setFilterExpandState(false);});handle('filter-cancel',function(e){var filterWidget=findWidget(e);if(restoreFilterState(filterWidget)){updateFilterResult(filterWidget);}
setFilterExpandState(false);});handle('filter-param-clear',function(e){var paramName=$(e.currentTarget).data('clear-param');var paramBee=$(e.delegateTarget).find('.param-line[data-param="'+paramName+'"]').prop('bee');fillParamCheckState(paramBee,false);saveFilterState(findWidget('filter-panel'));});handle('filter-clear',function(e){var paramBee;$(e.delegateTarget).find('.param-line[data-param]').each(function(index,paramEl){fillParamCheckState(paramEl.bee,false);paramEl.bee.$replace('param.all',false);paramBee=paramBee||paramEl.bee;});saveFilterState(findWidget('filter-panel'));});return handler;}});module.exports=QCActionPanel;},{"../componentBase":28,"../qc-action-button":37,"../qc-date-picker":39,"../qc-dropdown-list":40,"../qc-search":43,"beejs":2,"beejs/addons/event":1}],39:[function(_dereq_,module,exports){'use strict';var tpl="<div class=\"tc-15-calendar-select-wrap tc-15-calendar2-hook\">\n\n  <div role=\"tablist\" b-if=\"tabs\" b-style=\"{ opacity: disabled ? 0.4 : 1 }\">\n    <span b-repeat=\"tab in tabs\" role=\"tab\" tabindex=\"0\"\n          class=\"{{tab.current ? 'current' : ''}}\"\n          b-style=\"{ cursor: disabled ? 'not-allowed' : ''}\"\n          data-from=\"{{tab.from}}\"\n          data-to=\"{{tab.to}}\"\n          b-on=\"{ click: handleTabSelect }\">{{tab.label}}</span>\n  </div>\n\n  <div class=\"tc-15-calendar-select{{calPopup ? ' show' : ''}}\" b-if=\"showCalendar\" disabled?=\"disabled\">\n    <button class=\"tc-15-simulate-select m{{calPopup ? ' show' : ''}}\" b-on=\"{ mousedown: handlePickButtonDown.bind(this) }\">{{displayCalendarText(value)}}</button>\n\n    <div class=\"tc-15-calendar-triangle-wrap\"></div>\n\n    <div class=\"tc-15-calendar-triangle\"></div>\n\n    <div class=\"tc-15-calendar tc-15-calendar2\" b-on=\"{ click: handleDateClick, mousedown: stopPropagation }\" b-style=\"{ 'margin-left': pull == 'right' ? '-200px' : '' }\">\n      <div class=\"tc-15-calendar-cont\" style=\"font-size: 0;\">\n        <table class=\"{{month.className}}\" cellspacing=\"0\" b-repeat=\"month in months\">\n          <caption>{{month.display}}</caption>\n          <thead>\n            <tr>\n              <th b-repeat=\"weekday in langs[lang].weekdays\">{{weekday}}</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td colspan=\"7\">\n                <i class=\"tc-15-calendar-i-pre-m{{month.hasPrev ? '' : ' disabled'}}\" tabindex=\"0\"\n                   b-if=\"$index == 0\"\n                   b-on=\"{ click: prevMonth }\">\n                  <b>\n                    <span b-if=\"month.hasPrev\">{{langs[lang].prev_month}}</span>\n                    <span b-if=\"!month.hasPrev\">{{langs[lang].prev_month_disabled}}</span>\n                  </b>\n                </i>\n                <i class=\"tc-15-calendar-i-next-m{{month.hasNext ? '' : ' disabled'}}\" tabindex=\"0\"\n                   b-if=\"$index == months.length - 1\"\n                   b-on=\"{ click: nextMonth }\">\n                  <b>\n                    <span b-if=\"month.hasNext\">{{langs[lang].next_month}}</span>\n                    <span b-if=\"!month.hasNext\">{{langs[lang].next_month_disabled}}</span>\n                  </b>\n                </i>\n              </td>\n            </tr>\n            <tr b-repeat=\"week in month.weeks\">\n              <td b-repeat=\"day in week.days\" class=\"{{day.className}}\" data-date=\"{{day.date}}\">\n                {{day.display}}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n      <div class=\"tc-15-calendar-footer\">\n        <div class=\"tc-15-calendar-input\">\n          <div class=\"tc-15-input-text-wrap m\">\n            <input type=\"text\"\n               class=\"tc-15-input-text\"\n               data-role=\"date-from\"\n               value=\"{{parseDate(selected.from) || value.tab.display}}\"\n               b-on=\"{ keyup: parseDateInput, blur: validateDateInput }\"\n               disabled?=\"mode == 'duration' && durationAnchor != 'start'\"\n            />\n          </div>\n          <span role=\"separator\" b-if=\"mode == 'range' || mode == 'duration'\">{{langs[lang].to}}</span>\n          <div class=\"tc-15-input-text-wrap m\" b-if=\"mode == 'range' || mode == 'duration'\">\n            <input type=\"text\"\n               class=\"tc-15-input-text\"\n               data-role=\"date-to\"\n               value=\"{{parseDate(selected.to)}}\"\n               b-on=\"{ keyup: parseDateInput, blur: validateDateInput }\"\n               disabled?=\"mode == 'duration' && durationAnchor != 'end'\"\n            />\n          </div>\n          <!--<div b-if=\"formatError\" class=\"tc-15-calendar-error\">格式错误，应为YY-MM-DD</div>-->\n        </div>\n        <div class=\"tc-15-calendar-btns\">\n          <button class=\"tc-15-btn m{{selected ? '' : ' disabled'}}\" b-on=\"{ click: acceptPick }\" disabled?=\"!selected\">{{langs[lang].ok}}</button>\n          <button class=\"tc-15-btn m weak\" b-on=\"{ click: cancelPick }\">{{langs[lang].cancel}}</button>\n        </div>\n      </div>\n      <div class=\"tc-15-calendar-for-style\"></div>\n    </div>\n  </div>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var Event=_dereq_('beejs/addons/event');_dereq_('beejs/src/es5-bee-shim');var SELECTED_START_CLASS='tc-15-calendar-first';var SELECTED_RANGE_CLASS='tc-15-calendar-current';var SELECTED_END_CLASS='tc-15-calendar-last';var SELECTED_SINGLE_CLASS='tc-15-calendar-today';var DISABLE_CLASS='tc-15-calendar-dis';var PREV_MONTH_CLASS='tc-15-calendar-left';var LAST_MONTH_CLASS='tc-15-calendar-right';function parseISO8601(dateStringInRange){var isoExp=/^\s*(\d{4})-(\d\d)-(\d\d)\s*/,date=new Date(NaN),month,parts=isoExp.exec(dateStringInRange);if(parts){month=+parts[2];date.setFullYear(parts[1],month-1,parts[3]);if(month!=date.getMonth()+1){date.setTime(NaN);}}
return date;}
function dateToInt(date){if(!date)return 0;if(typeof date=='string')date=parseISO8601(date);return date.getFullYear()*10000+(date.getMonth()+1)*100+date.getDate();}
function dateToStr(date){function pad(number){var r=String(number);if(r.length===1){r='0'+r;}
return r;}
if(typeof date=='number'){return String(date).replace(/(\d\d\d\d)(\d\d)(\d\d)/,'$1-$2-$3');}
return[date.getFullYear(),pad(date.getMonth()+1),pad(date.getDate())].join('-');}
function swap(obj,key1,key2){var tmp=obj[key1];obj[key1]=obj[key2];obj[key2]=tmp;}
function _parseDate(dateStr){if(/^(\d{4})[-\s\.,\/]*(\d\d)[-\s\.,\/]*(\d\d)\s*$/.test(dateStr)){var year=RegExp.$1;var month=RegExp.$2;var day=RegExp.$3;return[year,month,day].join('-');}
return null;}
function isValidDateString(dateStr){return!isNaN(+parseISO8601(dateStr));}
function dateOffset(date,day){date=new Date(date);date.setDate(date.getDate()+day);return date;}
function dateDelta(date1,date2){return Math.floor(+parseISO8601(date2)-+parseISO8601(date1))/(24*60*60*1000);}
var defaults={months:[],selected:{from:'%TODAY',to:'%TODAY'},placeHolder:'请选择日期',tabs:[],value:{from:null,to:null},range:{min:null,max:null,maxLength:0},mode:'range',durationLength:1,durationAnchor:'start',today:dateToStr(new Date()),focusDate:null,showCalendar:true,calPopup:false,disabled:false,lang:'zh-cn',langs:{'zh-cn':{'caption_year':'年','caption_month':'月','weekdays':['日','一','二','三','四','五','六'],'to':'至','ok':'确定','cancel':'取消','prev_month':'转到上个月','next_month':'转到下个月','prev_month_disabled':'之前时间不可选','next_month_disabled':'之后时间不可选'},'en-us':{'caption_year':'/','caption_month':'','weekdays':['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],'to':'To','ok':'OK','cancel':'Cancel','prev_month':'Previous Month','next_month':'Next Month','prev_month_disabled':'Invalid for date before','next_month_disabled':'Invalid for date after'}},onPick:function onPick(){return null;},pull:'left'};var QCDatePicker=Base.extend({constructor:function constructor(){Base.apply(this,arguments);this._update();this._updateValue();},getState:function getState(){var selected=this.selected;if(!selected||!selected.from||!selected.to||!isValidDateString(selected.from)||!isValidDateString(selected.to)){return'empty';}
return selected.from==selected.to?'single':'range';},getAllowRange:function getAllowRange(){if(!this.range)return null;var range=$.extend({},this.range);if(this.mode=='duration'){if(this.durationAnchor=='start'&&range.max){range.max=dateToStr(dateOffset(range.max,1-this.durationLength));}
if(this.durationAnchor=='end'&&range.min){range.min=dateToStr(dateOffset(range.min,this.durationLength-1));}}
return range;},$mixins:[Event],$tpl:tpl,$afterInit:function $afterInit(){var _this=this;$(document).on('mousedown',function(){if(_this.calPopup&&!_this._popupingUp){_this.cancelPick();}});this.$watch('[mode, durationLength, durationAnchor]',this._update.bind(this));},_getLangText:function _getLangText(key){return this.langs[this.lang][key];},_getClassNameMapper:function _getClassNameMapper(){var root=this;var selected={from:this.selected?dateToInt(this.selected.from):null,to:this.selected?dateToInt(this.selected.to):null};var allowRange=this.getAllowRange();var range={min:allowRange?dateToInt(allowRange.min):null,max:allowRange?dateToInt(allowRange.max):null};if(selected.to<selected.from){swap(selected,'from','to');}
if(range.max<range.min){swap(range,'min','max');}
var maxLength=this.range&&this.range.maxLength;if(maxLength&&selected.from==selected.to){var from=parseISO8601(_parseDate(selected.from));var to=parseISO8601(_parseDate(selected.from));var min=dateOffset(from,-maxLength);var max=dateOffset(to,+maxLength);min=dateToInt(min);max=dateToInt(max);if(!range.min||min>range.min){range.min=min;}
if(!range.max||max<range.max){range.max=max;}}
return function mapper(date){date=dateToInt(date);var className=[];if(root.getState()!='empty'&&date>=selected.from&&date<=selected.to){if(date==selected.from&&date==selected.to){className.push(SELECTED_SINGLE_CLASS);}else if(date==selected.from){className.push(SELECTED_START_CLASS);}else if(date==selected.to){className.push(SELECTED_END_CLASS);}else{className.push(SELECTED_RANGE_CLASS);}}
if(range.min&&date<range.min||range.max&&date>range.max){className.push(DISABLE_CLASS);}
return className.join(' ');};},_buildMonth:function _buildMonth(firstDateOfMonth,monthClassName){var month=firstDateOfMonth.getMonth();var weeks=[];var mapClassName=this._getClassNameMapper();var firstDate=null;var lastDate=null;var buildWeek=function buildWeek(date){if(date.getMonth()==(month+1)%12){return false;}
var days=[];for(var i=0;i<7;i++){if(date.getMonth()==month){var day={display:date.getDate(),date:dateToStr(date),className:mapClassName(date)};days.push(day);firstDate=firstDate||new Date(date);lastDate=new Date(date);}
else{days.push({className:DISABLE_CLASS});}
date.setDate(date.getDate()+1);}
return{days:days,className:monthClassName};};var week;var date=new Date(firstDateOfMonth);date.setDate(1-date.getDay());while(week=buildWeek(date)){weeks.push(week);}
return{weeks:weeks,display:firstDateOfMonth.getFullYear()+this._getLangText('caption_year')+(month+1)+this._getLangText('caption_month'),hasPrev:!this.range.min||dateToInt(firstDate)>dateToInt(this.range.min),hasNext:!this.range.max||dateToInt(lastDate)<dateToInt(this.range.max)};},_resolveDate:function _resolveDate(dateStr){var today=this.today;if(!dateStr){return null;}
if(/%TODAY([+-]\d+)?/.test(dateStr)){var delta=parseInt(RegExp.$1,10)||0;var date=parseISO8601(today);date.setDate(date.getDate()+delta);dateStr=dateToStr(date);}
return dateStr;},_resolveRange:function _resolveRange(range){if(!range)return null;if(range.from){range.from=this._resolveDate(range.from);}
if(range.to){range.to=this._resolveDate(range.to);}
if(range.min){range.min=this._resolveDate(range.min);}
if(range.max){range.max=this._resolveDate(range.max);}
return range;},_update:function _update(){this.$replace('selected',this._resolveRange(this.selected));this.$replace('range',this._resolveRange(this.range));var focusDate=this.focusDate;if(!focusDate){focusDate=this.selected&&this.selected.to?parseISO8601(this.selected.to):new Date();if(isNaN(focusDate)){focusDate=new Date();}
this.focusDate=focusDate;}
var months=[];var date=new Date(focusDate);date.setDate(1);months.unshift(this._buildMonth(date,PREV_MONTH_CLASS));date.setMonth(date.getMonth()-1);months.unshift(this._buildMonth(date,LAST_MONTH_CLASS));this.$replace('months',months);},_updateTabs:function _updateTabs(selected){var tabs=this.tabs;if(!tabs)return;for(var i=0;i<tabs.length;i++){var tab=this._resolveRange(tabs[i]);var isCurrent=selected&&tab.from==selected.from&&tab.to==selected.to;tabs.$set(i,{current:isCurrent});}},_jumpMonth:function _jumpMonth(e,d){if($(e.target).closest('i').hasClass('disabled'))return;this.focusDate.setMonth(this.focusDate.getMonth()+d);this._update();},parseDate:function parseDate(str){return _parseDate(str);},nextMonth:function nextMonth(e){this.$root._jumpMonth(e,+1);},prevMonth:function prevMonth(e){this.$root._jumpMonth(e,-1);},handlePickButtonDown:function handlePickButtonDown(e){var _this2=this;if(this.disabled)return;if(!this.calPopup){this._popupingUp=true;this.$replace('calPopup',true);setTimeout(function(){return _this2._popupingUp=false;});}},handleDateClick:function handleDateClick(e){e.stopPropagation();var $clicked=$(e.target);if($clicked.hasClass(DISABLE_CLASS)){return;}
var date=$clicked.data('date');if(!date){return;}
var selected=$.extend({},this.selected);switch(this.getState()){case'empty':selected.from=selected.to=date;break;case'single':if(this.mode=='range'){var from=dateToInt(selected.from);var to=dateToInt(date);if(from==to){break;}
if(from>to){selected.from=date;}else{selected.to=date;}}else{selected.from=selected.to=date;}
break;case'range':selected.from=selected.to=date;break;}
if(this.mode=='duration'){if(this.durationAnchor=='end'){selected.from=dateToStr(dateOffset(selected.to,1-this.durationLength));}else{selected.to=dateToStr(dateOffset(selected.from,this.durationLength-1));}}
this.$set('selected',selected);this._update();},parseDateInput:function parseDateInput(e){var dateString=$(e.target).val();var date=_parseDate(dateString);if(!date)return;var role=$(e.target).data('role');var selected=this.selected;var allowed=this.getAllowRange();var from,to;switch(this.mode){case'single':from=to=dateToInt(date);break;case'range':if(role=='date-from'){from=dateToInt(date);to=dateToInt(selected.to)||from;}else if(role=='date-to'){to=dateToInt(date);from=dateToInt(selected.from)||to;}
break;case'duration':if(role=='date-from'){from=dateToInt(date);to=dateToInt(dateOffset(date,this.durationLength-1));}else if(role=='date-to'){to=dateToInt(date);from=dateToInt(dateOffset(date,1-this.durationLength));}}
if(!from&&!to){return;}
if(from>to){var t=from;from=to;to=t;}
if(allowed.min){from=Math.max(dateToInt(allowed.min),from);to=Math.max(dateToInt(allowed.min),to);}
if(allowed.max){from=Math.min(dateToInt(allowed.max),from);to=Math.min(dateToInt(allowed.max),to);}
if(this.mode=='duration'&&from>=to){if(role=='date-to'){from=dateToInt(dateOffset(_parseDate(to),1-this.durationLength));}else{to=dateToInt(dateOffset(_parseDate(from),this.durationLength-1));}}
if(this.range.maxLength){var max=dateOffset(parseISO8601(selected.from),this.range.maxLength);var min=dateOffset(parseISO8601(selected.to),-this.range.maxLength);max=dateToInt(max);min=dateToInt(min);if(role=='date-to'&&max<to)to=max;if(role=='date-from'&&min>from)from=min;}
if(!isNaN(from)){selected.from=dateToStr(from);}
if(!isNaN(to)){selected.to=dateToStr(to);}
var focus=this.focusDate;if(role=='date-from'){from=parseISO8601(selected.from);if(from.getMonth()<focus.getMonth()-1||from.getMonth()>focus.getMonth()){from.setMonth(from.getMonth()+1);this.focusDate=from;}}
if(role=='date-to'){to=parseISO8601(selected.to);if(to.getMonth()<focus.getMonth()-1||to.getMonth()>focus.getMonth()){this.focusDate=to;}}
this._update();var newValue=role=='date-from'?selected.from:selected.to;if(newValue!=$(e.target).val()){$(e.target).val(newValue);}},validateDateInput:function validateDateInput(e){var dateString=$(e.target).val();var date=_parseDate(dateString);if(!date&&this.value&&!this.value.tab&&!this.value.tab.display){var selected=this.$data.selected;$(e.target).val(selected[$(e.target).data('role').split('-').pop()]);}},stopPropagation:function stopPropagation(e){e.stopPropagation();},_updateValue:function _updateValue(){var selected=this.selected;this._updateTabs(selected);if(!selected){this.$replace('value',null);return;}
var value={from:selected.from,to:selected.to,length:Math.abs(dateDelta(selected.from,selected.to))+1};var tabs=this.tabs;for(var i=0;i<tabs.length;i++){var tab=tabs[i];if(tab.from==value.from&&tab.to==value.to){value.tab=tab;break;}}
this.$replace('value',value);return value;},displayCalendarText:function displayCalendarText(value){if(value&&value.tab&&value.tab.display){return value.tab.display;}
if(this.getState()=='empty'){return this.placeHolder;}
if(this.getState()=='single'){return value.from;}
return[value.from,this.langs[this.lang].to,value.to].join(' ');},acceptPick:function acceptPick(){if(!this.selected)return;var value=this._updateValue();var focusDate=parseISO8601(this.selected.to);if(!isNaN(+focusDate)){this.focusDate=focusDate;}
this._update();this.$replace('calPopup',false);this.$emit('datepick',value);if(typeof this.onPick=='function'){this.onPick(value);}},cancelPick:function cancelPick(){var selected=this.selected;var value=this.value;this.$set({selected:value?{from:value.from||selected.from,to:value.to||selected.to}:null});var focusDate=parseISO8601(this.selected&&this.selected.to);if(!isNaN(+focusDate)){this.focusDate=focusDate;}
this._update();this.$replace('calPopup',false);if(typeof this.onCancel=='function'){this.onCancel(value);}},handleTabSelect:function handleTabSelect(e){if(this.$root.disabled)return;var $tab=$(e.target);if($tab.hasClass('current'))return;var from=$tab.data('from');var to=$tab.data('to');var label=$tab.text();this.$root.setSelectedRange(from,to,label);this.$root.acceptPick();},setSelectedRange:function setSelectedRange(from,to,label){if(!to){to=from;}
this.$set({selected:from?{from:this._resolveDate(from),to:this._resolveDate(to),label:label}:null});this._updateValue();var focusDate=parseISO8601(to);if(!isNaN(+focusDate)){this.focusDate=focusDate;}
this._update();},setAllowRange:function setAllowRange(min,max,maxLength){this.$data.range.min=this._resolveDate(min);this.$data.range.max=this._resolveDate(max);this.$data.range.maxLength=maxLength;this._update();}},{defaults:defaults});module.exports=QCDatePicker;},{"../componentBase":28,"beejs":2,"beejs/addons/event":1,"beejs/src/es5-bee-shim":20}],40:[function(_dereq_,module,exports){'use strict';var tpl="<div b-on=\"$events\" data-role=\"qcSelect\" class=\"tc-15-simulate-select-wrap\">\n\t<button data-handler class=\"tc-15-simulate-select m{{popup ? ' show' : ''}}\" b-style=\"style\">\n\t\t{{simulateSelect ? (selected ? selected.label : label) : label}}\n\t</button>\n  <div class=\"dropdown-list-mask\" style=\"left: 0; right: 0; bottom: 0; top: 0; position: fixed; background: transparent; z-index: 999;\" b-style=\"{display: popup ? 'block' : 'none'}\"></div>\n\t<ul data-list class=\"tc-15-simulate-option\" style=\"z-index: 1000;\" b-style=\"{ display: popup ? 'block' : 'none'}\">\n\t\t<span b-content=\"listTpl\"></span>\n\t</ul>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var defaults={popup:false,simulateSelect:false,label:'更多',list:[]};var QCDropdownList=Base.extend({$tpl:tpl,listTpl:'<li data-item b-repeat="item in list" tabindex="0">{{item.label}}</li>',constructor:function constructor(){var _this=this;Base.apply(this,arguments);var selected=this.selected||this.list[0];this.$set('selected',selected);this.popup?this.open():this.close();$(window).on('click.qc-dropdown-list',function(e){if(!$(e.target).parents().is(_this.$el)){_this.close();}});},$beforeDestroy:function $beforeDestroy(){$(window).off('click.qc-dropdown-list');},open:function open(){this.$set('popup',true);},close:function close(){this.$set('popup',false);},onSelect:function onSelect(selected){},select:function select(item){var selected;if(typeof item==='object'){selected=item.bee&&item.bee.$data||item;}else if(!isNaN(item*1)){selected=this.list[item];}
if(!selected){return;}
this.close();this.$replace('selected',selected);this.$emit('selected',selected);this.onSelect(selected);if(typeof selected.action=='function'){selected.action.call(selected,selected);}},$events:{'click [data-handler]':function clickDataHandler(e){this.popup?this.close():this.open();},'click [data-item]':function clickDataItem(e){this.select(e.currentTarget);},'click .dropdown-list-mask':function clickDropdownListMask(){this.close();}}},{defaults:defaults});module.exports=QCDropdownList;},{"../componentBase":28,"beejs":2}],41:[function(_dereq_,module,exports){'use strict';var tpl="<div class=\"tc-15-calendar-select-wrap tc-15-calendar2-hook\">\n  <div class=\"tc-15-calendar-select tc-15-calendar-month show\">\n    <button class=\"tc-15-simulate-select m{{state.popup ? ' show' : ''}}\" b-on-click=\"_togglePopup()\">{{state.year}} 年 {{state.month}} 月</button>\n    <div class=\"tc-15-calendar-triangle-wrap\" b-if=\"state.popup\"></div>\n    <div class=\"tc-15-calendar-triangle\" b-if=\"state.popup\"></div>\n    <div class=\"tc-15-calendar tc-15-calendar2\" b-if=\"state.popup\" b-on=\"{click: _stopPropagation}\">\n      <div class=\"tc-15-calendar-cont\">\n        <table class=\"tc-15-calendar-mm\" cellspacing=\"0\">\n          <caption>\n            {{state.year}}年\n          </caption>\n          <tbody>\n          <tr>\n            <td colspan=\"2\">\n              <i class=\"tc-15-calendar-i-pre-m{{state.prevYearExcceed ? ' disabled' : ''}}\"\n                 tabindex=\"0\" b-on-click=\"_setYear(state.year - 1)\">\n                <b><span>{{state.prevYearExcceed ? texts.prevYearDisabled : texts.prevYear}}</span></b>\n              </i>\n            </td>\n            <td colspan=\"2\">\n              <i class=\"tc-15-calendar-i-next-m{{state.nextYearExcceed ? ' disabled' : ''}}\"\n                 tabindex=\"0\" b-on-click=\"_setYear(state.year + 1)\">\n                <b><span>{{state.nextYearExcceed ? texts.nextYearDisabled : texts.nextYear}}</span></b>\n              </i>\n            </td>\n          </tr>\n          <tr b-repeat=\"monthRow in [0, 1, 2]\">\n            <td b-repeat=\"monthCol in [1, 2, 3, 4]\" class=\"{{_getMonthClass(state.year, monthRow * 4 + monthCol, selected)}}\"\n                b-on-click=\"_pickMonth(monthRow * 4 + monthCol)\">\n              {{monthRow * 4 + monthCol}}月\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n      <div class=\"tc-15-calendar-for-style\"></div>\n    </div>\n  </div>\n</div>";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var monthPattern=/^(\d{4})(\d{2})$/;function parseMonth(str){if(!str){return{};}
var year,month,match;str=String(str);if(str=='current'){year=new Date().getFullYear();month=new Date().getMonth()+1;}else if(match=monthPattern.exec(str)){year=parseInt(match[1],10);month=parseInt(match[2],10);}else{throw new RangeError('日期格式不正确，请使用 yyyymm 的格式');}
return{year:year,month:month,value:year*100+month};}
var defaults={mode:'single',minValue:null,maxValue:'current',state:{popup:false,year:new Date().getFullYear(),month:new Date().getMonth()+1},texts:{prevYear:'转到上一年',prevYearDisabled:'上一年不可用',nextYear:'转到下一年',nextYearDisabled:'下一年不可用'}};var QCMonthPicker=Base.extend({$tpl:tpl,$afterInit:function $afterInit(){var _this=this;if(this.value){this._updateValue(this.value);}
this._updateState();this._updateSelected();this.$watch('value',this._setValue);$(document).on('click',this._globalClickHandler=function(){return _this.toggling||_this.$set('state.popup',false);});},$destroy:function $destroy(){$(document).off('click',this._globalClickHandler);},$valuekey:'value',_stopPropagation:function _stopPropagation(e){e.stopPropagation();},_setValue:function _setValue(valueStr){var value=parseMonth(valueStr);if(!value.year||this._monthExceed(value.year,value.month))return;this.$set('state',$.extend(this.state,{year:value.year,month:value.month}));this._updateState();this._updateSelected();},_togglePopup:function _togglePopup(){var _this2=this;this.toggling=true;this.$set('state.popup',!this.state.popup);setTimeout(function(){return _this2.toggling=false;});},_updateState:function _updateState(){this.$set('state',$.extend(this.state,{prevYearExcceed:this._yearExceed(this.state.year-1),nextYearExcceed:this._yearExceed(this.state.year+1)}));},_updateSelected:function _updateSelected(){this.$replace('selected',{year:this.state.year,month:this.state.month,toString:function toString(){return String(this.year*100+this.month);}});var value=this.selected.toString();if(this.value!=value){this.$set('value',value);}},_yearExceed:function _yearExceed(year){var minYear=parseMonth(this.minValue).year;var maxYear=parseMonth(this.maxValue).year;return minYear&&year<minYear||maxYear&&year>maxYear;},_monthExceed:function _monthExceed(year,month){var value=year*100+month;var minValue=parseMonth(this.minValue).value;var maxValue=parseMonth(this.maxValue).value;return minValue&&value<minValue||maxValue&&value>maxValue;},_getMonthClass:function _getMonthClass(year,month){if(this._monthExceed(year,month)){return'tc-15-calendar-dis';}
if(this.selected.year==this.state.year&&this.selected.month==month){return'tc-15-calendar-mm-select';}},_setYear:function _setYear(year){if(this._yearExceed(year))return;this.$set('state',$.extend(this.state,{year:year}));this._updateState();},_pickMonth:function _pickMonth(month){if(this._monthExceed(this.state.year,month)){return;}
this.$set('state',$.extend(this.state,{month:month}));this._updateSelected();this.$set('state',$.extend(this.state,{popup:false}));}},{defaults:defaults});module.exports=QCMonthPicker;},{"../componentBase":28,"beejs":2}],42:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"qc-popover\" style=\"display:none;z-index:999\" class=\"tc-15-bubble {{_getPosClass(position)}}\" b-style=\"style\">\n    <div class=\"tc-15-bubble-inner\" b-style=\"_getLeft(position)\">\n        {{> content }}\n    </div>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var box=_dereq_('../../lib/box');var classes={top:'tc-15-bubble-bottom',left:'tc-15-bubble-right',bottom:'tc-15-bubble-top',right:'tc-15-bubble-left','top left':'tc-15-bubble-bottom','top right':'tc-15-bubble-bottom','bottom left':'tc-15-bubble-top','bottom right':'tc-15-bubble-top'};var defaults={position:'bottom',auto:true,content:'',offset:{top:0,left:0},arrowOffset:8,arrowPad:14,trigger:'hover',hideDelay:300,hideDestroy:false,availablePos:['top','left','bottom','right','top left','top right','bottom left','bottom right']};var events={hover:['mouseenter','mouseleave'],click:['click','click'],focus:['focusin','focusout']};var popovers=[];var QcPopover=Base.extend({$tpl:tpl,$afterInit:function $afterInit(){QcPopover.__super__.$afterInit.call(this);this._$el=$(this.$el);if(!this.handler){this.$handler=$(this.$content).children();this.handler=this.$handler[0];this._$el.before(this.$handler);}else{this.$handler=$(this.handler);}
if(!this.target){this.target=this.handler;this.$target=this.$handler;}else{this.$target=$(this.target);}
if(typeof this.attachEl==='function'){this.attachEl(this.$el);}else{(this.attachEl?$(this.attachEl):this.$target).after(this.$el);}
this.$handler.data('qc-popover',this);this.$box=$(this.box||box.getBox(this.$el));this.bindEvent();popovers.push(this);},$afterDestroy:function $afterDestroy(){QcPopover.__super__.$afterDestroy.call(this);var index=popovers.indexOf(this);if(index>-1){popovers.splice(index,1);}
this.$handler.removeData('qc-popover');},target:null,handler:null,attachEl:null,reposition:function reposition(pos){var off=this._offset(pos);var newpos=this.auto&&this.suggested(pos,off);if(newpos&&newpos!==pos){pos=newpos;off=this._offset(pos);}
if(pos){if(this.availablePos.indexOf(pos)==-1){throw new Error('invalid position "'+pos+'"');}}
this.$set('position',pos);this._$el.css(off);},show:function show(){this._$el.fadeIn('fast');this.state=true;this.reposition(this.position);},hide:function hide(){this.state=false;this._$el.hide();this.hideDestroy&&this.$destroy(true);},suggested:function suggested(pos,off){var $box=this.$box;var $target=this.$target;var arrowOffset=this.arrowOffset;var toff=$target.offset();var boff=$box.offset()||{top:0,left:0};var tl=toff.left;var tt=toff.top;var tw=$target.outerWidth();var th=$target.outerHeight();var ew=this._$el.outerWidth()+arrowOffset;var eh=this._$el.outerHeight()+arrowOffset;var w,h;var box=$box[0];w=$box.innerWidth();h=$box.innerHeight();var good={top:true,bottom:true,left:true,right:true};if(toff.top+th+eh>boff.top+h)good.bottom=false;if(toff.top-boff.top<eh)good.top=false;if(toff.left-boff.left<ew)good.left=false;if(toff.left+tw+ew>boff.left+w)good.right=false;var positions=pos.split(/\s+/);if(good[positions[0]]&&(positions[1]?good[positions[1]]:true)&&this.availablePos.indexOf(pos)>-1){return pos;}
for(var i=0,position;position=this.availablePos[i];i++){positions=position.split(/\s+/);if(good[positions[0]]&&(positions[1]?good[positions[1]]:true)){return position;}}
return this.availablePos[0];},_offset:function _offset(pos){var arrowOffset=this.arrowOffset;var pad=this.arrowPad;var ew=this._$el.outerWidth();var eh=this._$el.outerHeight();var targetRect=this.$target.offset();if(!targetRect)throw new Error('could not get bounding client rect of `target`');var tw=this.$target.outerWidth();var th=this.$target.outerHeight();var to=offset(targetRect,this._$el.offsetParent());var off;if(!to)throw new Error('could not determine page offset of `target`');switch(pos){case'top':off={top:to.top-eh-arrowOffset,left:to.left+tw/2-ew/2};break;case'bottom':off={top:to.top+th+arrowOffset,left:to.left+tw/2-ew/2};break;case'right':off={top:to.top+th/2-eh/2,left:to.left+tw+arrowOffset};break;case'left':off={top:to.top+th/2-eh/2,left:to.left-ew-arrowOffset};break;case'top left':off={top:to.top-eh-arrowOffset,left:to.left+tw/2-ew+pad};break;case'top right':off={top:to.top-eh-arrowOffset,left:to.left+tw/2-pad};break;case'bottom left':off={top:to.top+th+arrowOffset,left:to.left+tw/2-ew+pad};break;case'bottom right':off={top:to.top+th+arrowOffset,left:to.left+tw/2-pad};break;default:throw new Error('invalid position "'+pos+'"');}
off.top+=this.offset.top;off.left+=this.offset.left;return off;},_getPosClass:function _getPosClass(position){return classes[position]||'';},_getLeft:function _getLeft(position){if(/\s+right$/.test(position)){return{left:12};}else if(/\s+left$/.test(position)){return{left:this._$el.width()-12};}},bindEvent:function bindEvent(){var _this=this;if(this.trigger){var $handler=this.$handler.add(this.$el);$handler.on(events[this.trigger][1],function(e){if(_this.trigger==='hover'&&($.contains(_this.$el,e.toElement)||$.contains(_this.$handler[0],e.toElement)||$handler.is(e.toElement))){return;}
clearTimeout(_this._delay);_this._delay=setTimeout(function(){_this.state&&_this.hide();},_this.hideDelay);}).on(events[this.trigger][0],function(){clearTimeout(_this._delay);});this.$handler.on(events[this.trigger][0],function(){_this.show();});}}},{defaults:defaults,hide:function hide(){popovers.forEach(function(popover){return popover.hide();});},hideExcept:function hideExcept(pop){popovers.forEach(function(popover){return pop!==popover&&popover.hide();});}});function offset(box,$offsetEl){var el=$offsetEl[0];var off=$offsetEl.offset()||{left:0,top:0};var scrollTop=$offsetEl.scrollTop();var scrollLeft=$offsetEl.scrollLeft();return{top:box.top+scrollTop-off.top,left:box.left+scrollLeft-off.left};}
var egroup='.qc_popover';QcPopover.bootFromAttr=function(attr){var Cstr=this;$(document).on('mouseenter'+egroup+' click'+egroup+' focusin'+egroup,'['+attr+']',function(e){var $target=$(this);var qcPopover,trigger;var data;if(!$target.data('qc-popover')){data=$target.data();trigger=data.trigger||Cstr.defaults.trigger;if(e.type===events[trigger][0]){qcPopover=new Cstr({$data:$.extend({},data,{handler:this,content:$target.attr(attr),position:$target.attr(attr+'-position'),style:$target.attr(attr+'-style')})});qcPopover.show();}}});};$(document).on('click',function(e){var $target=$(e.target);var popover;if($target.attr('data-role')==='qc-popover'||$target.parents('[data-role=qc-popover]').length){return;}
popover=$target.parents().data('qc-popover')||$target.data('qc-popover');if(popover){QcPopover.hideExcept(popover);return;}else{QcPopover.hide();}});QcPopover.bootFromAttr('qc-popover');module.exports=QcPopover;},{"../../lib/box":49,"../componentBase":28,"beejs":2}],43:[function(_dereq_,module,exports){'use strict';var tpl="<div b-on=\"$events\" data-role=\"qc-search\" class=\"tc-15-search {{multiple ? 'tc-15-multi-search' : ''}}\" b-style=\"style\">\n\t<textarea data-input class=\"tc-15-search-words\" placeholder=\"{{placeholder}}\" b-if=\"multiple\" b-model=\"keyword\"></textarea>\n  <input data-input class=\"tc-15-search-words\" placeholder=\"{{placeholder}}\" b-if=\"!multiple\" b-model=\"keyword\" type=\"text\" />\n\t<button data-search class=\"tc-15-btn weak m search\"></button>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var defaults={keyword:'',searchEmpty:false,multiple:false,placeholder:'请输入关键字'};var QCSearch=Base.extend({$tpl:tpl,$events:{'click [data-search]':function clickDataSearch(){this._search();},'keydown [data-input]':function keydownDataInput(e){var goSearch;if(e.keyCode==13){goSearch=this.multiple?e.ctrlKey:true;}
goSearch&&this._search();}},_search:function _search(){var keyword=this.keyword.trim();if(keyword===''&&!this.searchEmpty){return;}
this.search(keyword);this.onSearch(keyword);this.$el.querySelector('[data-input]').blur();$(this.$el).trigger('search',[keyword]);this.$emit('search',keyword);},getKeyword:function getKeyword(){return this.$get('keyword');},search:function search(keyword){console.log(keyword);},onSearch:function onSearch(keyword){}},{defaults:defaults});module.exports=QCSearch;},{"../componentBase":28,"beejs":2}],44:[function(_dereq_,module,exports){'use strict';var tpl="<div b-on=\"$events\" class=\"tc-15-dropdown {{styleType == 0 ? 'tc-15-dropdown-in-hd' : 'tc-15-dropdown-btn-style'}} tc-15-menu-{{popup ? 'active' : ''}}\">\n  <a data-handler href=\"javascript:;\" class=\"tc-15-dropdown-link\" b-style=\"style\">\n    {{simulateSelect ? (selected ? selected.label : label) : label}}<i class=\"caret\"></i>\n  </a>\n  <div class=\"dropdown-list-wrap\">\n    <div class=\"search-box search-box-simple m\" b-if=\"popup && filter\">\n        <div class=\"search-input-wrap\">\n            <textarea data-filter b-model=\"filterKey\" b-if=\"filter === 'multiple'\"\n              class=\"tc-15-input-text search-input\" placeholder=\"{{filterPlaceHolder}}\"></textarea>\n            <input data-filter type=\"text\" b-if=\"filter && filter !== 'multiple'\"\n              b-model=\"filterKey\"class=\" tc-15-input-text search-input\"  placeholder=\"{{filterPlaceHolder}}\">\n        </div>\n        <input class=\"search-btn\" type=\"button\" value=\"搜索\">\n    </div>\n    <ul data-list class=\"tc-15-dropdown-menu\" role=\"menu\">\n    \t<span b-content=\"listTpl\"></span>\n      <li b-if=\"!(list | _filter : filterKey).length\" class=\"disabled\">\n        <a href=\"javascript:;\">\n          无搜索结果\n        </a>\n      </li>\n    </ul>\n  </div>\n</div>\n";var Bee=_dereq_('beejs');var DropDown=_dereq_('../qc-dropdown-list');var QCSelect=DropDown.extend({$tpl:tpl,$valuekey:'selected',$afterInit:function $afterInit(){QCSelect.__super__.$afterInit.call(this);this.$watch('popup',function(popup){var filterEl;if(popup){this.$set('filterKey','');filterEl=this.$el.querySelector('[data-filter]');filterEl&&filterEl.focus();}});},_filter:function _filter(item){return true;},listTpl:'<li data-item role="presentation" b-repeat="item in list | _filter : filterKey" class="{{selected == item ? \'selected\' : \'\'}}">\n              <a role="menuitem" href="javascript:;">{{item.label}}</a>\n            </li>'},{defaults:{filterKey:'',filter:false,filterPlaceHolder:'请输入关键字',styleType:0,simulateSelect:true},filters:{_filter:function _filter(list,filterKey){return list.filter(function(item){return filterKey?item.label.indexOf(filterKey)>-1:true;});}}});module.exports=QCSelect;},{"../qc-dropdown-list":40,"beejs":2}],45:[function(_dereq_,module,exports){'use strict';var tpl="<div data-role=\"qc-tabs\">\n  <div class=\"tc-15-tab\">\n      <ul class=\"tc-15-tablist\" role=\"tablist\">\n          <li class=\"{{$index == activeIndex ? 'tc-cur': ''}}\" b-repeat=\"tab in list\">\n            <a b-on-click=\"$set('activeIndex', $index)\" role=\"tab\" title=\"{{tab.label}}\" href=\"javascript:;\">{{tab.label}}</a>\n          </li>\n      </ul>\n  </div>\n  <div data-tab-pane b-repeat=\"tab in list\" b-style=\"{display: $index == activeIndex ? 'block': 'none'}\">\n    {{> tab.content }}\n  </div>\n</div>\n";var Bee=_dereq_('beejs');var Base=_dereq_('../componentBase');var QcTabs=Base.extend({$tpl:tpl,$afterInit:function $afterInit(){QcTabs.__super__.$afterInit.call(this);this.$watch('activeIndex',function(i){this.$emit('tabchange',i);this.onChange(i);});},onChange:function onChange(){}},{defaults:{activeIndex:0}});module.exports=QcTabs;},{"../componentBase":28,"beejs":2}],46:[function(_dereq_,module,exports){'use strict';var Base=_dereq_('../componentBase');var tpl="<div class=\"tc-15-bubble\" data-role=\"qc-title\" data-state=\"{{state}}\" b-style='{left:x, top: y, display: state ? \"\" : \"none\", overflow: \"hidden\", maxWidth: maxWidth, maxHeight: maxHeight, width: width, height: height, zIndex: zIndex}'>\n    <div class=\"tc-15-bubble-inner\">{{> content || $content }}</div>\n</div>\n";var box=_dereq_('../../lib/box');var _qcTitle;var QcTitle=Base.extend({$tpl:tpl,$afterInit:function $afterInit(){QcTitle.__super__.$afterInit.call(this);_qcTitle&&_qcTitle.$destroy(true);_qcTitle=this;},$afterDestroy:function $afterDestroy(){QcTitle.__super__.$afterDestroy.call(this);_qcTitle=null;},setPosition:function setPosition(x,y){var newPos=this.reposition({x:x+this.offsetX,y:y+this.offsetY});this.$set(newPos);},reposition:function reposition(pos){var newPos={},$el=$(this.$el),$box=$(box.getBox(this.$el)),pOffset=$box.offset()||{left:0,top:0},ew=$el.width(),eh=$el.height(),pw=$box.width(),ph=$box.height();newPos.x=Math.min(pos.x,pw-ew+pOffset.left);newPos.y=Math.min(pos.y,ph-eh+pOffset.top);return newPos;}},{defaults:{state:true,offsetX:8,offsetY:1,zIndex:9999,maxWidth:360,maxHeight:'',width:'',height:''}});QcTitle.config=function(attr){$(document).off('.qc_title').on('mouseenter.qc_title click.qc_title','['+attr+']',function(e){var $target=$(this);var content=$target.attr(attr);var data=$target.data();if(!content){return;}
var old=$target.data('qcTitle');old&&old.$destroy(true);var qcTitle=new QcTitle({$data:$.extend({},data,{target:this,content:content})});var $tar=$target.add(qcTitle.$el);$tar.on('mouseleave.qc_title',function(e){if(!$.contains(qcTitle.$el,e.toElement)){$tar.off('.qc_title').removeData('qcTitle');qcTitle.$destroy(true);}});$target.add(qcTitle.$el).data('qcTitle',qcTitle);document.body.appendChild(qcTitle.$el);qcTitle.setPosition(e.clientX,e.clientY);}).on('mousemove.qc_title',function(e){if(_qcTitle){var $target=$(_qcTitle.target);var offset=$target.offset();var size={width:$target.outerWidth(),height:$target.outerHeight()};if(e.clientX<offset.left||e.clientX>offset.left+size.width||e.clientY<offset.top||e.clientY>offset.top+size.height){$target.add(_qcTitle.$el).off('.qc_title').removeData('qcTitle');_qcTitle.$destroy(true);}else{_qcTitle.setPosition(e.clientX,e.clientY);}}});};QcTitle.config('data-title');module.exports=QcTitle;},{"../../lib/box":49,"../componentBase":28}],47:[function(_dereq_,module,exports){'use strict';var tpl="<div class=\"tc-15-slider-wrap\" b-on=\"$events\" b-style=\"style\">\n  <div class=\"tc-15-slider-range\" b-ref=\"sliderBar\">\n    <div class=\"tc-15-slider-for-vis\"\n        b-style=\"{width: Math.max(0, Math.min(100, ((value - min) / (max - min)) * 100)) + '%'}\"></div>\n    <div class=\"tc-15-slider\" data-handler style=\"margin-left: -6px\" role=\"slider\" tabindex=\"0\"\n        b-style=\"{left: Math.max(0, Math.min(100, ((value - min) / (max - min)) * 100)) + '%' }\">\n      <div class=\"tc-15-slider-inner\"></div>\n    </div>\n    <div class=\"tc-15-slider-valuemin\">{{min}}{{unit}}</div>\n    <div class=\"tc-15-slider-valuemax\">{{max}}{{unit}}</div>\n  </div>\n  <div class=\"tc-15-input-text-wrap m\" b-if=\"showInput\">\n    <input type=\"text\" data-input b-model=\"value\" class=\"tc-15-input-text shortest\"> {{unit}}\n  </div>\n  <div b-if=\"tips\" class=\"tc-15-slider-tips\">{{tips}}</div>\n</div>\n";var Base=_dereq_('../componentBase');var Bee=_dereq_('beejs');var guid=0;var SliderRange=Base.extend({$tpl:tpl,$valuekey:'value',$afterInit:function $afterInit(){SliderRange.__super__.$afterInit.call(this);var that=this;var $body=$('body');this.guid=guid++;$body.on('mouseup.slider_'+that.guid,function(e){if(that._sliding){that._sliding=false;$body.off('mousemove.slider_'+that.guid);}});$(that.$el).on('mousedown.slider_'+this.guid,'[data-handler]',function(e){that._sliding=true;var fullWidth=$(that.$refs.sliderBar).width();var initX=e.clientX;var cur=that.value*1;$body.on('mousemove.slider_'+that.guid,function(e){if(that._sliding){var offset=(that.max-that.min)*(e.clientX-initX)/fullWidth;offset=Math.round(offset/that.step)*that.step;that.setValue(cur+offset);e.preventDefault();}});e.preventDefault();});$(that.$refs.sliderBar).on('click.slider_'+that.guid,function(e){var left=$(this).offset().left;var fullWidth=$(that.$refs.sliderBar).width();var value=(that.max-that.min)*(e.clientX-left)/fullWidth+that.min*1;value=Math.round(value/that.step)*that.step;that.setValue(value);});that.$watch('value',function(){this._checkValue();});that.$watch('min',function(){this._checkValue();});that.$watch('max',function(){this._checkValue();});},_checkValue:function _checkValue(){var that=this;var last=that._lastValue;var val=that.value,min=that.min*1,max=that.max*1;if(min<=max){if(val>max){val=max;}else if(val<min){val=min;}}
if(isNaN(val)){val=last;}
that._lastValue=val;that.$set('value',val);},$beforeDestroy:function $beforeDestroy(){$('body').off('.slider_'+this.guid);},getValue:function getValue(){return this.$get('value');},setValue:function setValue(value){var val=(this.min||this.min===0)&&this.max?Math.max(this.min,Math.min(this.max,value)):value;if(isNaN(val)){return false;}else{this.$set('value',val);return true;}},stepUp:function stepUp(){this.setValue(this.value*1+this.step*1);},stepDown:function stepDown(){this.setValue(this.value*1-this.step*1);},$events:{'click [data-input]':function clickDataInput(e){e.target.select();},'keydown':function keydown(e){if(e.keyCode==37||e.keyCode==40){this.stepDown();e.preventDefault();}else if(e.keyCode==38||e.keyCode==39){this.stepUp();e.preventDefault();}}}},{defaults:{step:1,min:0,max:100,value:50,showInput:true}});module.exports=SliderRange;},{"../componentBase":28,"beejs":2}],48:[function(_dereq_,module,exports){var Bee=_dereq_('beejs')
_dereq_('beejs/src/es5-bee-shim');_dereq_('./components/qc-title');Bee.tag('input-slider',_dereq_('./components/input-slider'));Bee.tag('device-selector',_dereq_('./components/device-selector'));Bee.tag('pagination',_dereq_('./components/pagination'));Bee.tag('grid-view',_dereq_('./components/grid-view'));Bee.tag('grid-view-header-filter',_dereq_('./components/grid-view-header-filter'));Bee.tag('qc-date-picker',_dereq_('./components/qc-date-picker'));Bee.tag('qc-dropdown-list',_dereq_('./components/qc-dropdown-list'));Bee.tag('qc-select',_dereq_('./components/qc-select'));Bee.tag('qc-search',_dereq_('./components/qc-search'));Bee.tag('qc-action-button',_dereq_('./components/qc-action-button'));Bee.tag('qc-action-panel',_dereq_('./components/qc-action-panel'));Bee.tag('slider-range',_dereq_('./components/slider-range'));Bee.tag('qc-popover',_dereq_('./components/qc-popover'));Bee.tag('qc-tabs',_dereq_('./components/qc-tabs'));Bee.tag('popup-confirm',_dereq_('./components/popup-confirm'));Bee.tag('grid-editor',_dereq_('./components/grid-editor'));Bee.tag('qc-month-picker',_dereq_('./components/qc-month-picker'));_dereq_('./mixins');module.exports=Bee;},{"./components/device-selector":29,"./components/grid-editor":30,"./components/grid-view":32,"./components/grid-view-header-filter":31,"./components/input-slider":34,"./components/pagination":35,"./components/popup-confirm":36,"./components/qc-action-button":37,"./components/qc-action-panel":38,"./components/qc-date-picker":39,"./components/qc-dropdown-list":40,"./components/qc-month-picker":41,"./components/qc-popover":42,"./components/qc-search":43,"./components/qc-select":44,"./components/qc-tabs":45,"./components/qc-title":46,"./components/slider-range":47,"./mixins":50,"beejs":2,"beejs/src/es5-bee-shim":20}],49:[function(_dereq_,module,exports){'use strict';exports.getBox=function(el){var node=el;var $offsetParent=$(el).offsetParent();while(el=el.parentNode){node=el;if(node===document||$(node).css('overflow')!=='visible'&&($offsetParent.is(node)||$.contains($offsetParent[0],node)||$.contains(node,$offsetParent[0]))){return node;}}
return node;};},{}],50:[function(_dereq_,module,exports){var ComponentBase=_dereq_('../components/componentBase');var mixins={'scroll-loader':_dereq_('./scroll-loader')};ComponentBase.getMixin=function(name){return mixins[name];};},{"../components/componentBase":28,"./scroll-loader":51}],51:[function(_dereq_,module,exports){function isElementInViewport(element,view,distance){if(typeof jQuery==="function"){if(element instanceof jQuery){element=element[0];}
if(view instanceof jQuery){view=view[0];}}
var rect=element.getBoundingClientRect();var viewRect=view.getBoundingClientRect();var viewport={left:viewRect.left-distance,top:viewRect.top-distance,right:viewRect.right+distance,bottom:viewRect.bottom+distance};var left=Math.max(rect.left,viewport.left),right=Math.min(rect.right,viewport.right),top=Math.max(rect.top,viewport.top),bottom=Math.min(rect.bottom,viewport.bottom);return left<=right&&top<=bottom;}
var instanceList=[];function ScrollLoader(options){options=$.extend({triggerDistance:0},options);return{$afterInit:function(){instanceList.push(this);if(typeof this.load!='function'){console.error('使用 ScrollLoader 需要实现 load() 方法，该方法请返回一个 Promise 对象');}
if(!this.scrollView){console.error('请为 ScrollLoader 指定 scrollView，可以为 Dom 或者 jQuery 选择器');}
var _this=this;$(this.scrollView).on('scroll',this._scrollLoadBindFn=function(){_this._detectLoad();});setTimeout(function(){_this.reload();},1);},$destroy:function(){var index=instanceList.indexOf(this);if(index!=-1){instanceList.splice(index,1);}
$(this.scrollView).off('scroll',this._scrollLoadBindFn);},_detectLoad:function(){if(this.loaderState!='pending')return;if(isElementInViewport(this.$el,$(this.scrollView)[0],options.triggerDistance)){var loadResult=this.load();this.$set('loaderState','triggered');if(loadResult&&typeof loadResult.then=='function'){var _this=this;loadResult.then(function(){_this.$set('loaderState','loaded');});}}},reload:function(){this.$set('loaderState','pending');this._detectLoad();}};}
$(window).on('DOMContentLoaded load resize',function(){instanceList.forEach(function(instance){instance._detectLoad();});});module.exports=ScrollLoader;},{}],52:[function(_dereq_,module,exports){},{}],53:[function(_dereq_,module,exports){var pSlice=Array.prototype.slice;var objectKeys=_dereq_('./lib/keys.js');var isArguments=_dereq_('./lib/is_arguments.js');var deepEqual=module.exports=function(actual,expected,opts){if(!opts)opts={};if(actual===expected){return true;}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime();}else if(typeof actual!='object'&&typeof expected!='object'){return opts.strict?actual===expected:actual==expected;}else{return objEquiv(actual,expected,opts);}}
function isUndefinedOrNull(value){return value===null||value===undefined;}
function isBuffer(x){if(!x||typeof x!=='object'||typeof x.length!=='number')return false;if(typeof x.copy!=='function'||typeof x.slice!=='function'){return false;}
if(x.length>0&&typeof x[0]!=='number')return false;return true;}
function objEquiv(a,b,opts){var i,key;if(isUndefinedOrNull(a)||isUndefinedOrNull(b))
return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false;}
a=pSlice.call(a);b=pSlice.call(b);return deepEqual(a,b,opts);}
if(isBuffer(a)){if(!isBuffer(b)){return false;}
if(a.length!==b.length)return false;for(i=0;i<a.length;i++){if(a[i]!==b[i])return false;}
return true;}
try{var ka=objectKeys(a),kb=objectKeys(b);}catch(e){return false;}
if(ka.length!=kb.length)
return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])
return false;}
for(i=ka.length-1;i>=0;i--){key=ka[i];if(!deepEqual(a[key],b[key],opts))return false;}
return typeof a===typeof b;}},{"./lib/is_arguments.js":54,"./lib/keys.js":55}],54:[function(_dereq_,module,exports){var supportsArgumentsClass=(function(){return Object.prototype.toString.call(arguments)})()=='[object Arguments]';exports=module.exports=supportsArgumentsClass?supported:unsupported;exports.supported=supported;function supported(object){return Object.prototype.toString.call(object)=='[object Arguments]';};exports.unsupported=unsupported;function unsupported(object){return object&&typeof object=='object'&&typeof object.length=='number'&&Object.prototype.hasOwnProperty.call(object,'callee')&&!Object.prototype.propertyIsEnumerable.call(object,'callee')||false;};},{}],55:[function(_dereq_,module,exports){exports=module.exports=typeof Object.keys==='function'?Object.keys:shim;exports.shim=shim;function shim(obj){var keys=[];for(var key in obj)keys.push(key);return keys;}},{}]},{},[48])(48)});/*  |xGv00|423329bb75f7cf25ee334432322f303c */