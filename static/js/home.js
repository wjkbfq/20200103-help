(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{37:function(e,t,a){"use strict";var n=a(0),r=a.n(n),o=(a(151),a(22)),c=a(2),l=a(1),i=a(26),s=a(9);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var g=function(e){function t(){var e,a,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return n=this,r=(e=p(t)).call.apply(e,[this].concat(i)),a=!r||"object"!==u(r)&&"function"!=typeof r?d(n):r,h(d(d(a)),"state",{loading:!1}),h(d(d(a)),"installPlugin",function(){var e=a.props,t=e.id,n=e.pluginName,r=e.refresh,o=e.showNotice;a.setState({loading:!0}),c.a.installPlugin({pluginId:t}).then(function(e){a.setState({loading:!1}),0===e.code?(r(),o({message:"插件 ".concat(n,' 已成功安装，请至 <a href="').concat(l.a.studioUrl,'/dashboard/plugin/thirdparty" target="_blank">控制面板</a> 中查看。'),color:"green"})):400===e.status?o({message:'请前往 <a href="'.concat(l.a.devUrl,'/user/account/setting" target="_blank">个人设置</a> 修改用户名后再安装。'),color:"red"}):o({message:e.msg||e.message,color:"red"})})}),h(d(d(a)),"uninstallPlugin",function(){var e=a.props,t=e.id,n=e.pluginName,r=e.refresh,o=e.showNotice;a.setState({loading:!0}),c.a.uninstallPlugin({pluginId:t}).then(function(e){a.setState({loading:!1}),0===e.code?(r(),o({message:"插件 ".concat(n," 已成功卸载。"),color:"green"})):400===e.status?o({message:'请前往 <a href="'.concat(l.a.devUrl,'/user/account/setting" target="_blank">个人设置</a> 修改用户名后再卸载。'),color:"red"}):o({message:e.msg,color:"red"})})}),a}var a,g,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,n["Component"]),a=t,(g=[{key:"render",value:function(){var e=this.props,t=e.profile,a=e.pathname,n=e.ids,c=e.id,u=e.pluginName,f=e.userAvatar,p=e.createdBy,m=e.installCount,d=e.remark,h=e.avgScore,g=this.state.loading,y=n.includes(Number(c));return r.a.createElement("div",{className:"market-card"},r.a.createElement("div",{className:"card-title"},r.a.createElement("a",{className:"name",href:"/plugins/detail/".concat(c)},u),t.name===p&&r.a.createElement("span",{className:"tag"},"我开发的")),r.a.createElement("div",{className:"up"},r.a.createElement("div",{className:"author"},r.a.createElement("img",{src:Object(s.a)(f),alt:"avatar"}),r.a.createElement("span",null,p)),r.a.createElement("div",{className:"installcount"},r.a.createElement("img",{src:"".concat(l.a.staticPrefix,"/install.svg"),alt:"install"}),r.a.createElement("span",null,Object(i.a)(m)))),r.a.createElement("div",{className:"desc"},r.a.createElement("span",null,d)),r.a.createElement("div",{className:"low"},r.a.createElement(o.a,{score:h}),t.name?y?r.a.createElement("button",{className:"uninstall",onClick:this.uninstallPlugin},g?"卸载中...":"卸载"):r.a.createElement("button",{className:"install",onClick:this.installPlugin},g?"安装中...":"安装"):r.a.createElement("a",{href:"".concat(l.a.loginUrl,"?return_url=").concat(l.a.studioUrl).concat(a)},r.a.createElement("button",{className:"install"},"安装"))))}}])&&f(a.prototype,g),y&&f(a,y),t}();t.a=g},498:function(e,t,a){__NEXT_REGISTER_PAGE("/home",function(){return e.exports=a(524),{page:e.exports.default}})},524:function(e,t,a){"use strict";a.r(t);var n=a(4),r=a.n(n),o=a(0),c=a.n(o),l=(a(113),a(499),a(47)),i=a(43),s=a(44),u=a(45),f=a(58),p=a(59),m=a(60),d=a(37),h=(a(505),function(e){var t=e.types;return c.a.createElement("div",{className:"market-type"},t.map(function(e){var t=e.id,a=e.value;return c.a.createElement("a",{key:t,className:"type",href:"/plugins/list?type=".concat(t,"&sort=sumScore&page=1")},a)}))}),g=a(46),y=a(2);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var c,l=e[Symbol.iterator]();!(n=(c=l.next()).done)&&(a.push(c.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function w(e,t,a,n,r,o,c){try{var l=e[o](c),i=l.value}catch(e){return void a(e)}l.done?t(i):Promise.resolve(i).then(n,r)}function N(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var o=e.apply(t,a);function c(e){w(o,n,r,c,l,"next",e)}function l(e){w(o,n,r,c,l,"throw",e)}c(void 0)})}}function P(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var j=function(e){function t(){var e,a,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=new Array(c),i=0;i<c;i++)l[i]=arguments[i];return n=this,o=(e=k(t)).call.apply(e,[this].concat(l)),a=!o||"object"!==v(o)&&"function"!=typeof o?O(n):o,_(O(O(a)),"state",{profile:{},ids:[],searchPlugins:[],searching:!1,loading:!1,keywords:"",page:0,size:12,total:1,isNoticeOn:!1,noticeMessage:"",noticeColor:""}),_(O(O(a)),"fetchUserProfile",N(r.a.mark(function e(){var t,n,o,c,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,y.a.getUserProfile();case 3:(n=e.sent)&&0===n.code&&(o=n.data,c=o.avatar,l=o.global_key,t.avatar=c,t.name=l,a.fetchInstalledPlugins()),a.setState({profile:t});case 6:case"end":return e.stop()}},e,this)}))),_(O(O(a)),"fetchInstalledPlugins",N(r.a.mark(function e(){var t,n,o,c,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,Promise.all([y.a.getInstalledPlugin(),y.a.getInstalledDisabledPlugin()]);case 3:n=e.sent,o=E(n,2),c=o[0],l=o[1],0===c.code&&c.data.forEach(function(e){t.push(e.id)}),0===l.code&&l.data.forEach(function(e){t.push(e.id)}),a.setState({ids:t});case 8:case"end":return e.stop()}},e,this)}))),_(O(O(a)),"fetchSearchPlugins",function(){var e=N(r.a.mark(function e(t){var n,o,c,l,i,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.keywords,o=t.page,c=t.size,n){e.next=4;break}return a.setState({searchPlugins:[],searching:!1,page:0,total:1}),e.abrupt("return");case 4:return a.setState({loading:!0,searching:!0}),l={keywords:n,pluginTypeId:-1,page:o||a.state.page,size:c||a.state.size},e.next=8,y.a.getPublicPlugins(l);case 8:i=e.sent,Array.isArray(i.contents)?(s=i.page,a.setState({keywords:n,searchPlugins:i.contents,loading:!1,page:s.number,total:s.totalPages})):a.showNotice({message:i.msg,color:"red"});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),_(O(O(a)),"handlePager",function(e){var t=a.state,n=t.keywords,r=t.size;a.setState({page:e}),a.fetchSearchPlugins({keywords:n,page:e,size:r})}),_(O(O(a)),"showNotice",function(e){var t=e.message,n=e.color;a.setState({isNoticeOn:!0,noticeMessage:t,noticeColor:n})}),_(O(O(a)),"hideNotice",function(){return a.setState({isNoticeOn:!1})}),a}var a,n,w;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,o["Component"]),a=t,n=[{key:"render",value:function(){var e=this,t=this.props,a=t.pathname,n=t.topPlugins,r=t.newPlugins,y=t.types,v=this.state,E=v.profile,w=v.ids,N=v.searchPlugins,P=v.searching,k=v.loading,S=v.keywords,O=v.page,_=v.total,j=this.state,x=j.isNoticeOn,C=j.noticeMessage,I=j.noticeColor;return c.a.createElement(o.Fragment,null,c.a.createElement(l.a,{profile:E,pathname:a}),c.a.createElement("div",{className:"market-main market-home"},c.a.createElement("div",{className:"banner"},c.a.createElement("div",{className:"title"},"Cloud Studio 插件市场"),c.a.createElement("div",{className:"detail"},c.a.createElement("span",null,"插件大赛获奖名单公布，"),c.a.createElement("a",{href:"https://studio.dev.tencent.com/campaign/favorite-plugins/detail",target:"_blank",rel:"noopener noreferrer"},"前往查看"),c.a.createElement("span",null,"。")),c.a.createElement(f.a,{defaultValue:S,search:this.fetchSearchPlugins})),P?c.a.createElement("div",{className:"box"},c.a.createElement("div",{className:"title"},"搜索结果"),c.a.createElement("div",{className:"container"},k?c.a.createElement(p.a,null):N.length?N.map(function(t){return c.a.createElement(d.a,b({key:t.id},t,{profile:E,pathname:a,ids:w,showNotice:e.showNotice,refresh:e.fetchInstalledPlugins}))}):c.a.createElement(m.a,null)),_>1&&c.a.createElement(g.a,{page:O,total:_,handler:this.handlePager})):c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"box"},c.a.createElement("div",{className:"title"},c.a.createElement("span",null,"评分最高"),c.a.createElement("a",{href:"/plugins/list?type=-1&sort=sumScore&page=1"},c.a.createElement("span",null,"更多 "),c.a.createElement("i",{className:"fa fa-angle-right"}))),c.a.createElement("div",{className:"container"},n.map(function(t){return c.a.createElement(d.a,b({key:t.id},t,{profile:E,pathname:a,ids:w,showNotice:e.showNotice,refresh:e.fetchInstalledPlugins}))}))),c.a.createElement("div",{className:"box"},c.a.createElement("div",{className:"title"},c.a.createElement("span",null,"最近发布"),c.a.createElement("a",{href:"/plugins/list?type=-1&sort=lastDeployDate&page=1"},c.a.createElement("span",null,"更多 "),c.a.createElement("i",{className:"fa fa-angle-right"}))),c.a.createElement("div",{className:"container"},r.map(function(t){return c.a.createElement(d.a,b({key:t.id},t,{profile:E,pathname:a,ids:w,showNotice:e.showNotice,refresh:e.fetchInstalledPlugins}))})))),c.a.createElement("div",{className:"box"},c.a.createElement("div",{className:"title"},"插件分类"),c.a.createElement(h,{types:y}))),c.a.createElement(i.a,null),c.a.createElement(s.a,null),x&&c.a.createElement(u.a,{message:C,color:I,destroy:this.hideNotice}))}},{key:"componentDidMount",value:function(){this.fetchUserProfile()}}],w=[{key:"getInitialProps",value:function(){var e=N(r.a.mark(function e(t){var a,n,o,c,l,i,s,u,f;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.req,n=t.asPath,o=a?n:"".concat(location.pathname).concat(location.search),c=[],e.next=5,y.a.getPublicPlugins({keywords:"",pluginTypeId:-1,field:"sumScore",page:0,size:6});case 5:return(l=e.sent)&&Array.isArray(l.contents)&&(c=l.contents),i=[],e.next=10,y.a.getPublicPlugins({keywords:"",pluginTypeId:-1,field:"lastDeployDate",page:0,size:6});case 10:return(s=e.sent)&&Array.isArray(s.contents)&&(i=s.contents),u=[],e.next=15,y.a.getPluginTypes();case 15:return(f=e.sent)&&0===f.code&&(u.push({id:-1,value:"全部分类"}),f.data.forEach(function(e){u.push({id:e.id,value:e.typeName})})),e.abrupt("return",{pathname:o,topPlugins:c,newPlugins:i,types:u});case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}],n&&P(a.prototype,n),w&&P(a,w),t}();t.default=j},58:function(e,t,a){"use strict";var n=a(0),r=a.n(n);a(148);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f=function(e){function t(){var e,a,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,i=new Array(c),f=0;f<c;f++)i[f]=arguments[f];return n=this,r=(e=l(t)).call.apply(e,[this].concat(i)),a=!r||"object"!==o(r)&&"function"!=typeof r?s(n):r,u(s(s(a)),"state",{keywords:""}),u(s(s(a)),"handleInput",function(e){var t=e.target.value.replace("<","&lt").replace(">","&gt");a.setState({keywords:t})}),u(s(s(a)),"handleEnter",function(e){13===e.keyCode&&a.handleSearch()}),u(s(s(a)),"handleSearch",function(){var e=a.state.keywords;a.props.search({keywords:e})}),a}var a,f,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,n["Component"]),a=t,(f=[{key:"render",value:function(){var e=this.props.defaultValue;return r.a.createElement("div",{className:"market-search"},r.a.createElement("input",{type:"text",defaultValue:e,spellCheck:!1,placeholder:"搜索插件",onChange:this.handleInput,onKeyUp:this.handleEnter}),r.a.createElement("i",{className:"fa fa-search",onClick:this.handleSearch}))}}])&&c(a.prototype,f),p&&c(a,p),t}();t.a=f},59:function(e,t,a){"use strict";var n=a(0),r=a.n(n);a(149);t.a=function(){return r.a.createElement("div",{className:"market-loading"},r.a.createElement("div",{className:"loading"},r.a.createElement("div",{className:"ring"}),r.a.createElement("div",{className:"ring"}),r.a.createElement("div",{className:"ring"}),r.a.createElement("div",{className:"ring"})),r.a.createElement("div",{className:"message"},"加载中"))}},60:function(e,t,a){"use strict";var n=a(0),r=a.n(n);a(150);t.a=function(){return r.a.createElement("div",{className:"market-nodata"},r.a.createElement("i",{className:"fa fa-frown-o"}),r.a.createElement("span",null,"没有数据"))}}},[[498,1,0,2]]]);